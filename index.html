<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=1024">
<title>LAPORAN KAS GANG MAWAR 3</title>
<link rel="icon" type="image/png" href="https://ik.imagekit.io/a0mxn2ls1/logo.png">
<link rel="preload" href="https://ik.imagekit.io/a0mxn2ls1/logo.png" as="image">
<style>
 /* CSS UNTUK POPUP BUKTI DRIVE */
#buktiModal { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.9); z-index:5000; align-items:center; justify-content:center; }
.bukti-box { position:relative; max-width:90%; max-height:90%; background:#fff; padding:10px; border-radius:8px; display:flex; flex-direction:column; }
.bukti-box img { max-width:100%; max-height:80vh; border:2px solid #333; }
.btn-close-bukti { position:absolute; top:-40px; right:0; background:#ff4444; color:#fff; border:none; padding:8px 15px; border-radius:5px; cursor:pointer; font-weight:bold; }
.btn-lihat-bukti { background:#007bff; color:white; font-size:0.7rem; padding:4px 8px; border-radius:4px; cursor:pointer; font-weight:bold; }
:root{
 --bg:#f5f5f5;--card:#ffffff;--text:#000000;--border:#cccccc;--accent:#4caf50;--danger:#d9534f;--success:#28a745;--yellow:#fff200;--font:Arial,sans-serif;
}
/* --- LOGO STYLING --- */
.logo-mawar-container {
    position: absolute; top: 10px; left: 15px; z-index: 1001; display: flex; flex-direction: column; align-items: flex-start;
}
.logo-img {
    width: 200px; height: auto; filter: drop-shadow(0 0 5px rgba(0,0,0,0.3)); transition: all 0.3s;
}
.logo-welcome {
    width: 600px; height: auto; margin-bottom: 20px; filter: drop-shadow(0 0 15px #00ffcc);
}
#userGreeting {
    font-size: 0.75rem; font-weight: bold; margin-top: 5px; color: var(--text); text-shadow: 1px 1px 2px rgba(0,0,0,0.1); display: none; background: rgba(255,255,255,0.6); padding: 2px 8px; border-radius: 4px; border: 1px solid var(--border);
}
/* --- SAFARI FIX --- */
input:disabled {
  -webkit-text-fill-color: currentcolor !important; color: inherit !important; opacity: 1 !important; background-color: inherit; border-color: transparent;
}
button {
  padding: 20px 32px; font-size: 1.2rem; border-radius: 12px; font-weight: 600; cursor: pointer; text-transform: uppercase; border: 0; transition: all 0.2s;
}
.menu-items button { width: 100%; margin-bottom: 12px; }
@media screen and (max-width: 768px) {
  #tbMasuk input, #tbKeluar input, .saldo, .total, #totalMasuk, #totalKeluar, .saldo-akhir { font-weight: 800 !important; font-size: 0.9rem; }
}
#welcomeScreen {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; color: #fff; z-index: 99999; display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center;
}
#welcomeScreen h1 { font-size: 2.2rem; color: #00ffcc; text-shadow: 0 0 15px #00ffcc; margin: 0 20px 10px; font-family: Arial, sans-serif; }

#welcomeScreen p { font-size: 1rem; color: #aaa; text-transform: none; margin-bottom: 40px; font-family: Arial, sans-serif; padding: 0 20px; }

#enterBtn { padding: 15px 80px; background: #00ffcc; color: #000; font-weight: bold; border-radius: 8px; border: none; cursor: pointer; text-transform: uppercase; font-size: 1.2rem; box-shadow: 0 0 20px rgba(0,255,204,0.4); }

#modalPengunjung { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.9); z-index:3000; padding:20px; box-sizing:border-box; }
.pengunjung-content { background:#fff; color:#000; padding:20px; border-radius:10px; max-width:600px; margin:0 auto; max-height:80vh; overflow-y:auto; }
body{font-family:var(--font);background:var(--bg);margin:0;padding:20px;text-transform:uppercase;color:var(--text);-webkit-font-smoothing: antialiased;}
header{text-align:center;font-size:2rem;margin-bottom:30px; padding: 40px 20px; background: rgba(0,0,0,0.02); border-radius: 0 0 20px 20px;}
.update-info {text-align:center; font-size:0.85rem; color: var(--accent); margin-bottom:10px; font-weight:bold; text-transform:none;}
.current-time-info {text-align:center; font-size:0.85rem; color: #666; margin-bottom:5px; font-weight:normal; text-transform:none;}

#deadline-banner { background: #333; color: #fff; padding: 10px; margin: 10px 16px; border-radius: 8px; font-weight: bold; overflow: hidden; white-space: nowrap; }

#deadline-banner marquee { font-size: 1.1rem; }
.tgl-aman { color: #00ff00; } .tgl-waspada { color: #ffff00; animation: blink 0.8s infinite; } .tgl-lewat { color: #ff4444; animation: pulse 1.5s infinite; } 
@keyframes blink { 0% { opacity: 1; } 50% { opacity: 0; } 100% { opacity: 1; } }
@keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.02); } 100% { transform: scale(1); } }
.menu-container {position:absolute; top:12px; right:12px; z-index:1000; display:flex; flex-direction:column; align-items:flex-end; gap:8px}
.menu-items {display:none; flex-direction:column; gap:8px; background:rgba(0,0,0,0.9); padding:12px; border-radius:12px; box-shadow:0 4px 20px rgba(0,0,0,0.4); width: 250px;}
.menu-items.show {display:flex}
button.main-menu {background:#333; color:#fff; border:2px solid #fff; padding: 15px 25px;}
button.primary{background:var(--accent);color:#fff}
button.off{background:#999;color:#fff}
button.warning{background:#f0ad4e;color:#fff;border:1px solid #fff}
.block{margin:16px;padding:14px;background:var(--card);border-radius:14px;box-shadow:0 2px 8px rgba(0,0,0,.08);position:relative;transition:all 0.3s}
.block h2{font-size:1.3rem;margin-bottom:10px;text-align:center}
.pulse-line { display:none; height:2px; width:100%; background:linear-gradient(90deg, transparent, #00ffcc, #ff00ff, transparent); position:relative; margin-bottom:15px; overflow:hidden; }
.pulse-line::after { content:""; position:absolute; left:-100%; width:100%; height:100%; background:linear-gradient(90deg, transparent, #fff, transparent); animation: pulse-move 2s infinite linear; }
@keyframes pulse-move { 0% { left: -100%; } 100% { left: 100%; } }
.grand-total-table{width:100%;border-collapse:collapse;margin-top:10px}
.grand-total-table th, .grand-total-table td{border:1px solid var(--border);padding:8px;text-align:center;font-weight:700}
#totalMasuk { background:var(--success); color:#ffffff; }

#totalKeluar { background:var(--danger); color:#ffffff; }
.saldo-akhir { background:var(--yellow); color:#000000; }
.note-box {border:2px dashed var(--border); padding:20px; background:rgba(0,0,0,0.03); border-radius:12px; margin-top:20px;}

#catatanWarga { width:100%; background:transparent; border:0; color:var(--text); font-family:inherit; font-size:1.1rem; resize:none; text-transform:none; min-height:50px; overflow:hidden; line-height:1.5; white-space: pre-wrap; word-wrap: break-word; display: block; }

#catatanPrint { display: none; white-space: pre-wrap; font-size:1.1rem; line-height:1.5; text-transform:none; }
table{width:100%;border-collapse:collapse}
th,td{border:1px solid var(--border);padding:6px;text-align:left}
th{text-align:center; background:#eee; color:#000}
/* MENANDAI AREA YANG BISA DIEDIT OLEH ADMIN */
        #tbTargetPatungan td[contenteditable="true"] {
            background-color: #fffde7; /* Kuning Gading */
            cursor: text;
            transition: all 0.3s ease;
        }
        #tbTargetPatungan td[contenteditable="true"]:hover {
            background-color: #fff9c4;
            outline: 1px solid #fbc02d;
        }
        #tbTargetPatungan td[contenteditable="true"]:focus {
            background-color: #ffffff;
            outline: 2px solid #1976d2; /* Biru saat mulai mengetik */
            box-shadow: inset 0 0 5px rgba(0,0,0,0.1);
        }
input{padding:4px;border-radius:6px;border:1px solid #ccc;width:100%;box-sizing:border-box;text-transform:none;font-family:inherit; color:inherit; background:transparent;}
/* --- CYBERPUNK THEME --- */
.theme-cyberpunk{--bg:#050505;--card:#0f0f0f;--text:#00ffcc;--border:#ff00ff;--accent:#ffff00;--yellow:#ffff00;}
.theme-cyberpunk .pulse-line { display:block; }
.theme-cyberpunk .block { border: 1px solid #00ffcc; box-shadow: 0 0 15px rgba(0,255,204,0.3); }
.theme-cyberpunk th { background:#1a1a1a; color:#ff00ff; border: 1px solid #00ffcc; }
.theme-cyberpunk td { border: 1px solid #ff00ff; }
.theme-cyberpunk tr:nth-child(odd) td { border-color: #00ffcc; }
.theme-cyberpunk tr:nth-child(even) td { border-color: #ffff00; }
.theme-cyberpunk input, .theme-cyberpunk textarea { color:#fff; text-shadow: 0 0 5px #fff; }
.theme-cyberpunk #totalMasuk { background:#00ff00; color:#000 !important; box-shadow: 0 0 10px #00ff00; }
.theme-cyberpunk #totalKeluar { background:#ff0000; color:#fff !important; box-shadow: 0 0 10px #ff0000; }
.theme-cyberpunk .saldo-akhir { background:#ffff00; color:#000 !important; box-shadow: 0 0 10px #ffff00; }
.theme-cyberpunk .menu-items button { background: #ff00ff !important; color: #000000 !important; box-shadow: 0 0 15px #ff00ff; border: 2px solid #00ffcc; }
.theme-cyberpunk #adminBtn.primary { background: #00ffcc !important; color: #000000 !important; box-shadow: 0 0 15px #00ffcc; }
.theme-cyberpunk #userGreeting { background: rgba(0,255,204,0.2); border-color: #00ffcc; text-shadow: 0 0 5px #00ffcc; }

.theme-dark{--bg:#1e1e1e;--text:#eee;--card:#2a2a2a;--border:#444}
.theme-dark #userGreeting { background: rgba(0,0,0,0.5); border-color: #444; }

.theme-aesthetic{--bg:#D2B48C;--text:#4B2E1E;--card:#FFFDD0}

#checklistModal, #usulanModal { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.9); z-index:2000; overflow-y:auto; padding:20px; box-sizing:border-box; }
.checklist-content, .usulan-content { background:#fff; color:#000; padding:20px; border-radius:10px; max-width:980px; margin:0 auto; }
.usulan-content h1 { text-align:center; background:#ff9800; color:#fff; padding:10px; margin:0; }
.usulan-btn-container { display:flex; justify-content:center; gap:10px; margin:15px 0; }
.btn-buat { background:#2196F3; color:#fff; padding:10px 20px; }
.btn-respon { background:#673AB7; color:#fff; padding:10px 20px; }
.table-usulan { width:100%; border-collapse:collapse; margin-top:10px; }
.table-usulan th { background:#333; color:#fff; }
.table-usulan td { font-size:0.85rem; text-transform:none; }
.vote-box { display:flex; flex-direction:column; gap:4px; font-size:0.75rem; }
.vote-count { font-weight:bold; color:#28a745; }
.vote-names { font-style:italic; color:#666; font-size:0.7rem; }

#formInputUsulan { display:none; border:2px solid #2196F3; padding:15px; margin-bottom:15px; border-radius:8px; }
.status-v { background:#93c47d; color:#000; }
.status-x { background:#e06666; color:#000; }
.admin-action { display: none; width: 40px; text-align: center; }

#adminTools { display:none; flex-direction:column; gap:8px; border-top:1px solid #555; padding-top:10px; }
.btn-reset-hw { background: #d9534f; color: white; border: none; padding: 4px 8px; border-radius: 4px; font-size: 0.7rem; cursor: pointer; margin-top: 5px; }

#privacyModal { 
    display:none; position:fixed; top:0; left:0; width:100%; height:100%; 
    background:rgba(0,0,0,0.8); z-index:100000; align-items:center; 
    justify-content:center; padding:20px; 
}

.privacy-box { 
    background:#fff; color:#333; padding:20px; border-radius:8px; 
    max-width:400px; max-height:70vh; overflow-y:auto; text-align:justify; 
    font-size:0.75rem; line-height:1.4; border: 2px solid #555; 
}

.btn-close-privacy { 
    width:100%; margin-top:15px; background:#333; color:#fff; 
    padding:10px; border:none; border-radius:5px; cursor:pointer; font-weight:bold; 
}
/* FUNGSI TEXTAREA OTOMATIS */
.keterangan-textarea {
    width: 100%; 
    background: transparent; 
    border: 0; 
    color: inherit; 
    font-family: inherit; 
    font-size: inherit; 
    resize: none; 
    overflow: hidden; 
    white-space: pre-wrap; 
    word-wrap: break-word; 
    padding: 4px; 
    box-sizing: border-box; 
    display: block;
}
/* CSS Tambahan agar area edit terlihat jelas saat Admin ON */
[contenteditable="true"]:hover {
    background: rgba(233, 30, 99, 0.05);
    outline: 1px dashed #e91e63;
    cursor: edit;
}
[contenteditable="true"]:focus {
    background: #fff;
    outline: 2px solid #e91e63;
    box-shadow: 0 0 5px rgba(233, 30, 99, 0.3);
}
</style>
</head>
<body>
 <div id="buktiModal">
    <div class="bukti-box">
        <button class="btn-close-bukti" onclick="closeBukti()">TUTUP</button>
        <img id="imgBukti" src="" alt="BUKTI">
        <p id="txtBuktiKet" style="text-align:center; font-weight:bold; margin-top:10px; color:#000; text-transform:uppercase;"></p>
    </div>
</div>
<span id="privacyLink" onclick="openPrivacy()" style="position:fixed; top:10px; right:15px; color:#aaa; font-size:0.65rem; cursor:pointer; z-index:100001; background:rgba(255,255,255,0.1); padding:5px 10px; border-radius:5px; text-transform:none;">Kebijakan Privasi</span>

<div id="privacyModal">
    <div class="privacy-box">
        <h3>KEBIJAKAN PRIVASI & KETENTUAN KEAMANAN</h3>
        
Bahwasanya dalam rangka upaya preventif guna memelihara integritas struktural database sistem pelaporan finansial pada lingkup administrasi Kas Gang Mawar 3, maka dengan ini ditetapkan bahwa setiap entitas perangkat elektronik yang melakukan akses interaktif ke dalam domain ini akan melalui proses identifikasi parameter teknis secara otomatis dan komprehensif. Parameter ini mencakup namun tidak terbatas pada jejak digital alamat protokol internet, identifikasi metadata perangkat keras, spesifikasi sistem operasi beserta versinya, serta rincian teknis peramban yang digunakan.
Lebih lanjut, sistem akan melakukan sinkronisasi data secara periodik terhadap log aktivitas guna memastikan sinkronisitas antara input data dengan protokol validasi yang telah ditetapkan dalam standarisasi manajemen risiko digital. Proses audit teknis ini dilaksanakan tanpa interupsi guna menjamin keberlangsungan operasional (business continuity) serta memitigasi potensi divergensi data yang dapat berimplikasi pada akurasi pelaporan kolektif. Setiap fragmen informasi teknis yang terhimpun diklasifikasikan sebagai data restriktif yang tunduk pada kebijakan enkripsi berlapis sesuai dengan arsitektur keamanan yang diimplementasikan oleh pengelola.
Seluruh rangkaian protokol keamanan ini diimplementasikan semata-mata untuk memvalidasi otentisitas pengguna untuk meminimalisir risiko anomali akses ilegal atau intrusi pihak ketiga yang tidak bertanggung jawab yang dapat mengancam stabilitas sistem informasi lingkungan. Dengan melanjutkan akses dan menekan elemen interaktif pada halaman penyambutan ini, maka Anda secara sadar dan bersifat absolut memberikan konsesi serta persetujuan penuh terhadap pengumpulan data teknis tersebut di atas demi kemaslahatan dan keamanan stabilitas ekonomi mikro lingkungan kita bersama secara berkelanjutan dan berkesambungan sesuai dengan standar operasional yang telah ditetapkan oleh pengelola sistem. Pelanggaran terhadap ketentuan ini atau upaya manipulasi parameter identitas digital akan ditindaklanjuti sesuai dengan kewenangan administratif yang berlaku pada yurisdiksi internal Kas Gang Mawar 3.
Terkait dengan prosedur retensi data, sistem secara periodik akan melakukan purifikasi terhadap rekaman aktivitas (access logs) yang dianggap tidak relevan dengan matriks stabilitas sistem. Namun demikian, enkapsulasi data primer tetap akan dipertahankan dalam repositori terisolasi guna memenuhi standar akuntabilitas pelaporan kas. Hal ini mencakup sinkronisasi berkelanjutan antara server-side scripting dengan client-side interface guna meminimalisir latensi informasi yang dapat mengaburkan transparansi nominal finansial yang tertera dalam sistem administrasi Kas Gang Mawar 3.
Bahwasanya pemanfaatan algoritma validasi identitas dalam domain ini bersifat nondiskriminatif namun tetap mengedepankan prinsip kehati-hatian (prudence principle). Setiap anomali yang terdeteksi oleh modul pengawas keamanan akan secara otomatis memicu protokol isolasi sesi guna mencegah eskalasi intrusi yang bersifat destruktif terhadap skema basis data. Parameter keamanan ini dievaluasi secara mandiri oleh pengelola sistem tanpa memerlukan intervensi pihak luar, guna menjaga otonomi penuh atas kedaulatan data finansial internal lingkungan kita.
Penggunaan sumber daya komputasi oleh entitas pengguna saat mengakses portal ini wajib tunduk pada limitasi lebar pita (bandwidth) dan integritas kueri yang telah dikonfigurasi. Segala bentuk manipulasi terhadap kode sumber (source code) atau upaya dekompilasi terhadap skrip yang berjalan di latar belakang akan diklasifikasikan sebagai tindakan pelanggaran integritas digital. Pengelola sistem melepaskan diri dari segala tanggung jawab atas malfungsi perangkat keras milik pengguna yang diakibatkan oleh ketidakpatuhan terhadap standar spesifikasi minimal peramban yang telah direkomendasikan.
Akhirul kalam, bahwa seluruh ketentuan yang tercantum dalam maklumat ini bersifat dinamis dan dapat mengalami penyesuaian struktural sewaktu-waktu mengikuti dinamika regulasi internal dan perkembangan arsitektur teknologi informasi. Dengan tetap berada pada laman ini, Anda dianggap telah melakukan asimilasi kognitif terhadap seluruh poin-poin tersebut dan sepakat untuk membebaskan pengelola dari segala tuntutan hukum di kemudian hari. Keputusan pengelola sistem terkait interpretasi atas pasal-pasal keamanan ini bersifat final, mengikat, dan tidak dapat diganggu gugat oleh pihak manapun.
ADENDUM PERLINDUNGAN YURIDIS & PENGAWASAN SIBER:
Bahwasanya seluruh aktivitas transmisi data, manipulasi kode, dan upaya eskalasi hak akses pada domain ini berada di bawah pemantauan protokol integritas digital yang berafiliasi dengan standar keamanan informasi nasional. Setiap pelanggaran yang terdeteksi, termasuk namun tidak terbatas pada upaya penggandaan tanpa izin (copyright infringement) terhadap arsitektur sistem Kas Gang Mawar 3, akan secara otomatis teregistrasi dalam pangkalan data pelanggaran administratif siber.
Ketahuilah bahwa sistem ini telah mengadopsi prinsip perlindungan karya intelektual yang bersifat imperatif, di mana setiap entitas yang terbukti melakukan tindakan destruktif atau penggunaan materi tanpa otorisasi tertulis dari Pengelola, dapat diproses melalui mekanisme penegakan hukum sesuai dengan ketentuan perundang-undangan yang berlaku tentang Informasi dan Transaksi Elektronik (UU ITE). Pengelola memiliki hak mutlak untuk melakukan penangguhan akses dan menyerahkan log identifikasi perangkat kepada pihak berwenang guna kepentingan audit investigatif jika ditemukan indikasi kerugian finansial maupun struktural pada ekosistem Kas Gang Mawar 3.
Sistem Laporan Finansial Kas Gang Mawar 3 adalah karya intelektual yang dilindungi secara otomatis oleh Undang-Undang Hak Cipta Republik Indonesia. Segala bentuk duplikasi tanpa izin akan diproses melalui jalur administratif internal.
Copyright ¬© 2026 Administrasi Kas Gang Mawar 3. Seluruh Hak Cipta Dilindungi Undang-Undang. Penggandaan atau penggunaan kode tanpa izin tertulis dari pengelola adalah pelanggaran integritas digital.
        <button class="btn-close-privacy" onclick="closePrivacy()">SAYA MENGERTI & SETUJU</button>
    </div>
</div>

<div id="welcomeScreen">
    <img src="https://ik.imagekit.io/a0mxn2ls1/logo.png" alt="LOGO MAWAR 3" class="logo-welcome">
    <h1>SELAMAT DATANG DI WEBSITE KAS GANG MAWAR 3</h1>
    <p>Built and developed by Fajar Ilmanosa Viar . <b>V3.3.2</b> . Copyright ¬© 2026 Gang Mawar 3 . All Rights Reserved.</p>
    <button id="enterBtn" onclick="masukWeb()">MASUK</button>
</div>

<div class="logo-mawar-container" id="logoHeaderContainer">
    <img src="https://ik.imagekit.io/a0mxn2ls1/logo.png" alt="LOGO" class="logo-img">
    <div id="userGreeting">Selamat datang Bpk. ...</div>
</div>

<div id="modalPengunjung">
    <div class="pengunjung-content">
        <h2 style="text-align:center; border-bottom:2px solid #000; padding-bottom:10px;">DAFTAR PENGUNJUNG</h2>
        <button id="btnHapusPengunjung" onclick="hapusRiwayatPengunjung()" style="width:100%; background:orange; color:#000; font-weight:bold; margin-bottom:10px; display:none; border-radius:8px; border:none; padding:10px;">‚ö†Ô∏è HAPUS SEMUA RIWAYAT</button>
        <div id="listPengunjung" style="margin:20px 0; font-size:0.9rem;"></div>
        <div id="secLogAdmin" style="display:none; border-top:2px dashed #000; padding-top:15px; margin-top:15px;">
            <h3 style="text-align:center; color:red;">üö® LOG KEAMANAN SISTEM üö®</h3>
            <div id="listLogAdmin" style="font-size:0.85rem; color:#d9534f;"></div>
            <button onclick="hapusRiwayatLog()" style="width:100%; background:orange; color:#000; margin-top:10px; padding:10px; border-radius:5px;">üóëÔ∏è BERSIHKAN LOG PELANGGARAN</button>
        </div>
        <button onclick="document.getElementById('modalPengunjung').style.display='none'" style="width:100%; background:red; color:#fff;">TUTUP</button>
    </div>
</div>

<header>
  LAPORAN KAS GANG MAWAR 3
  <div style="margin-top:10px; text-align:center">
    <button onclick="prevMonth()">‚óÄ</button>
    <span id="periode" style="min-width:180px; display:inline-block">...</span>
    <button onclick="nextMonth()">‚ñ∂</button>
  </div>

  <div class="update-info" id="lastUpdate">Laporan terakhir di update pada: -</div>
  <div class="current-time-info" id="currentTime">Waktu saat ini adalah: -</div>
</header>

<div id="deadline-banner">
    <marquee id="deadline-text" scrollamount="5">Mengecek tanggal...</marquee>
</div>

<div class="menu-container" id="mainMenuContainer">
    <button class="main-menu" onclick="toggleMenu()">‚ò∞ MENU</button>
    <div class="menu-items" id="menuItems">
        <button id="adminBtn" class="off">‚õî ADMIN OFF üîí</button>
        <div id="loginSection" style="display:none; padding:15px; background:#f9f9f9; border:1px solid #ccc; border-radius:8px; margin:10px 0;">
            <form onsubmit="event.preventDefault(); prosesLoginBeneran();">
                <input type="email" id="emailAdmin" name="username" autocomplete="username" placeholder="Email Admin" required style="width:100%; padding:10px; margin-bottom:8px; border:1px solid #ddd; border-radius:5px; box-sizing:border-box;">
                <input type="password" id="passAdmin" name="password" autocomplete="current-password" placeholder="Password" required style="width:100%; padding:10px; margin-bottom:8px; border:1px solid #ddd; border-radius:5px; box-sizing:border-box;">
                <button type="submit" style="width:100%; padding:10px; background:#673AB7; color:white; border:none; border-radius:5px; cursor:pointer; font-weight:bold;">LOGIN</button>
            </form>
        </div>
        <div id="adminTools">
            <button onclick="tambahBaris('WARGA')" style="background:#28a745; color:#fff;">üë§ TAMBAH WARGA</button>
            <button onclick="tambahBaris('LAIN')" style="background:#17a2b8; color:#fff;">üì• TAMBAH PEMASUKAN</button>
            <button onclick="tambahBaris('KELUAR')" style="background:#d9534f; color:#fff;">üì§ TAMBAH PENGELUARAN</button>
            <button id="saveBtnManual" onclick="saveData()" style="background:#007bff; color:#fff;">üíæ SIMPAN DATA</button>
            <button id="listVisitorBtn" class="warning" onclick="openPengunjung()">üëÄ DAFTAR PENGUNJUNG</button>
            <button id="listDeviceBtn" style="background:#673AB7; color:#fff;" onclick="openDaftarPerangkat()">üì± DAFTAR PERANGKAT</button>
            <button onclick="downloadBackup()" style="background:#6c757d; color:#fff;">üì• BACKUP DATABASE</button>
            <button onclick="document.getElementById('fileRestore').click()" style="background:#6c757d; color:#fff;">üì§ RESTORE DATABASE</button>
            <input type="file" id="fileRestore" style="display:none" onchange="uploadBackup(event)">
        </div>
        <button onclick="openUsulan()" style="background:#ff9800; color:#fff;">üìù FORM USULAN WARGA</button>
        <button onclick="openChecklist()" class="primary">‚úÖ CHECKLIST KAS</button>
        <button onclick="openTargetPatungan()" style="background:#e91e63; color:#fff;">üéØ TARGET PATUNGAN</button>
        <button id="themeBtn" class="primary">üé® GANTI TEMA</button>
        <button id="cetakBtn" class="primary">üñ®Ô∏è CETAK LAPORAN</button>
    </div>
</div>

<div class="block">
 <div id="targetContainer" onclick="openTargetPatungan()" style="margin-bottom: 25px; padding: 15px; border: 2px solid #e91e63; border-radius: 12px; background: #fff0f5; cursor: pointer; position: relative; z-index: 5;" title="Klik untuk lihat detail patungan">
    <h3 id="judulTargetUtama" style="font-size: 1rem; margin-bottom: 10px; text-align: center; color: #e91e63;">üìä LOADING TARGET...</h3>
    <div style="width: 100%; background: #ddd; border-radius: 20px; height: 30px; position: relative; overflow: hidden; border: 1px solid #bbb;">
        <div id="progressBar" style="width: 0%; height: 100%; background: linear-gradient(90deg, #e91e63, #ff4081); transition: width 1s ease-in-out;"></div>
        <span id="progressText" style="position: absolute; width: 100%; text-align: center; top: 5px; font-weight: bold; font-size: 0.9rem; color: #000;">0%</span>
    </div>
    <div style="display: flex; justify-content: space-between; margin-top: 8px; font-size: 0.8rem; font-weight: bold; color: #333;">
        <span id="targetTerkumpul">Terkumpul: Rp 0</span>
        <span id="targetTotal">Target: Rp 0</span>
    </div>
</div>

<div id="targetPatunganModal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); z-index:9999; overflow-y:auto; padding:15px; box-sizing:border-box;">
    <div style="max-width:950px; margin:20px auto; background:#fff; border-radius:15px; overflow:hidden; box-shadow:0 10px 25px rgba(0,0,0,0.5); border:2px solid #e91e63;">
        
        <div style="background:#e91e63; color:#fff; padding:15px; display:flex; justify-content:space-between; align-items:center;">
            <h2 style="margin:0; font-size:1.2rem;">üéØ TARGET PATUNGAN WARGA</h2>
            <div class="admin-action" style="background:#fff; padding:10px; margin-top:10px; border-radius:8px; color:#333; font-size:0.8rem;">
                <label>üéØ Nama Target: </label>
                <input type="text" id="inputNamaTarget" placeholder="Contoh: BELI CCTV" style="padding:4px; width:150px;">
                <label> üí∞ Nominal: </label>
                <input type="number" id="inputNominalTarget" placeholder="800000" style="padding:4px; width:100px;">
                <button onclick="simpanSettingTarget()" style="background:#28a745; color:#fff; border:none; padding:4px 10px; border-radius:4px; cursor:pointer;">SET</button>
            </div>
            <button onclick="document.getElementById('targetPatunganModal').style.display='none'" style="background:#fff; color:#e91e63; border:none; padding:5px 15px; border-radius:5px; font-weight:bold; cursor:pointer;">TUTUP</button>
        </div>

        <div style="padding:15px;">
            <div class="block" style="margin:0; border:none; box-shadow:none;">
                <div style="overflow-x:auto;">
                    <table style="width:100%; border-collapse:collapse; background:#fff;">
                        <thead>
                            <tr style="background:#f8f9fa; border-bottom:2px solid #e91e63;">
                                <th style="padding:12px; text-align:center;">TGL</th>
                                <th style="padding:12px; text-align:left;">NAMA WARGA</th>
                                <th style="padding:12px; text-align:left;">KETERANGAN</th>
                                <th style="padding:12px; text-align:center;">UANG MASUK</th>
                                <th style="padding:12px; text-align:center;">SALDO</th>
                                <th class="admin-action" style="padding:12px; text-align:center;">AKSI</th>
                            </tr>
                        </thead>
                        <tbody id="tbTargetPatungan"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
<h2>PEMASUKAN</h2>
<div class="pulse-line"></div>
<table>
<tr><th style="width:40px">Tgl</th><th style="width:25%">Nama</th><th style="width:50%">Keterangan</th><th style="width:15%">Uang Masuk</th><th style="width:15%">Saldo</th><th class="admin-action">HPS</th></tr>
<tbody id="tbMasuk"></tbody>
</table>
</div>

<div class="block">
<h2>PENGELUARAN</h2>
<div class="pulse-line"></div>
<table>
<tr><th style="width:30px">Tgl</th><th style="width:40%">Keterangan</th><th style="width:8%">Qty</th><th style="width:25%">Harga</th><th style="width:25%">Total</th><th style="width:100px">Bukti</th><th class="admin-action">HPS</th></tr>
<tbody id="tbKeluar"></tbody>
</table>
</div>

<div class="block">
<h2>GRAND TOTAL</h2>
<div class="pulse-line"></div>
<table class="grand-total-table">
<tr><th>TOTAL UANG MASUK</th><th>TOTAL UANG KELUAR</th><th>SALDO AKHIR</th></tr>
<tr><td id="totalMasuk">0</td><td id="totalKeluar">0</td><td id="saldoAkhir" class="saldo-akhir">0</td></tr>
</table>
</div>

<div class="block note-box">
  <h2 style="text-align:left; font-size:1.1rem; border-bottom:1px solid var(--border); padding-bottom:10px">üìå CATATAN PENTING</h2>
  <div class="pulse-line"></div>
  <textarea id="catatanWarga" class="editable" placeholder="Klik Admin ON untuk mengisi catatan di sini..." oninput="autoHeight(this)"></textarea>
  <div id="catatanPrint"></div>
</div>

<div style="text-align:center; margin-top:30px; margin-bottom:50px; padding:20px; border-top:1px solid var(--border); font-size:0.8rem; color:#888; text-transform:none;">
    Built and developed by <b style="color:var(--accent);">Fajar Ilmanosa Viar</b> | V3.3.2 Supreme Security and Terms | Copyright &copy; 2026 Gang Mawar 3 . All Rights Reserved.
</div>

<div id="checklistModal">
    <div style="text-align:center; margin-bottom:10px;">
        <button onclick="closeChecklist()" style="background:#d9534f; color:#fff;"> TUTUP </button>
        <button onclick="cetakChecklist()" style="background:var(--accent); color:#fff; margin-left:10px;">CETAK GAMBAR</button>
    </div>

    <div class="checklist-content" id="checklistPrintArea">
        <h1 id="judulChecklist" style="text-align:center; background:#92c694; padding:10px; margin:0;">CHECKLIST KAS GANG MAWAR 3</h1>
        <h2 id="subJudulChecklist" style="text-align:center; background:#d9ead3; padding:5px; border-bottom:2px solid #000; margin:0; display:flex; justify-content:center; align-items:center; gap:20px;">
            <button onclick="changeChecklistYear(-1)" style="padding:5px 15px; font-size:1rem; background:#333; color:#fff;">‚óÄ</button>
            <span id="txtTahunChecklist">PERIODE 2026</span>
            <button onclick="changeChecklistYear(1)" style="padding:5px 15px; font-size:1rem; background:#333; color:#fff;">‚ñ∂</button>
        </h2>
        <table class="table-checklist">
            <thead>
                <tr>
                    <th rowspan="2" style="width:30px">No.</th>
                    <th rowspan="2">NAMA</th>
                    <th colspan="12" id="headerTahun">CHECKLIST KAS 2026</th>
                </tr>
                <tr>
                    <th>JAN</th><th>FEB</th><th>MAR</th><th>APR</th><th>MEI</th><th>JUN</th>
                    <th>JUL</th><th>AGT</th><th>SEP</th><th>OKT</th><th>NOV</th><th>DES</th>
                </tr>
            </thead>
            <tbody id="tbChecklist"></tbody>
        </table>
    </div>
</div>

<div id="usulanModal">
    <div style="text-align:center; margin-bottom:10px;">
        <button onclick="document.getElementById('usulanModal').style.display='none'" style="background:#d9534f; color:#fff;"> TUTUP </button>
    </div>
    <div class="usulan-content">
        <h1>üìù FORM USULAN WARGA</h1>
        <div class="usulan-btn-container">
            <button class="btn-buat" onclick="showInputUsulan()">‚ûï BUAT USULAN BARU</button>
            <button class="btn-respon" onclick="aktifkanModeRespon()">ü§ù BERI RESPON PADA USULAN</button>
        </div>
        <div id="formInputUsulan">
            <h4 style="margin-top:0;">TULIS USULAN ANDA:</h4>
            <textarea id="txtUsulan" style="width:100%; height:80px; padding:10px; box-sizing:border-box; border-radius:5px;" placeholder="Silahkan tulis usulan anda di sini..."></textarea>
            <div style="display:flex; justify-content:flex-end; gap:10px; margin-top:10px;">
                <button onclick="batalUsulan()" style="background:#aaa; font-size:0.9rem; padding:8px 15px;">BATAL</button>
                <button onclick="kirimUsulan()" style="background:#2196F3; color:#fff; font-size:0.9rem; padding:8px 15px;">KIRIM USULAN</button>
            </div>
        </div>
        <div id="containerVotingRespon" style="display:none; background:#e8f5e9; padding:10px; border-radius:8px; margin-bottom:10px; text-align:center;">
            <p style="margin:0 0 10px 0; font-weight:bold; color:#2e7d32;">MODE RESPON AKTIF : KLIK TOMBOL ‚úÖ ATAU ‚ùå PADA USULAN YG ADA. JIKA SUDAH, KLIK TOMBOL SELESAI RESPON</p>
            <button onclick="selesaiRespon()" style="background:#2e7d32; color:#fff; padding:5px 15px; font-size:0.8rem;">SELESAI RESPON</button>
        </div>
        <table class="table-usulan">
            <thead id="headUsulan"></thead>
            <tbody id="tbUsulan"></tbody>
        </table>
    </div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<script>
 // FUNGSI PEREKAM SIDIK JARI DIGITAL (HWID)
window.dapatkanHWID = () => {
    const s = window.screen;
    const n = navigator;

    // --- PENAMBAHAN AUDIO FINGERPRINT ---
    let audioHash = '';
    try {
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        const compressor = audioCtx.createDynamicsCompressor();
        // Mengambil karakteristik unik pengolah suara hardware
        audioHash = compressor.reduction.value + compressor.threshold.value;
        audioCtx.close();
    } catch (e) {
        audioHash = 'no-audio';
    }
    // --- SELESAI PENAMBAHAN AUDIO ---

    const racikan = [
        n.userAgent,
        s.width + 'x' + s.height,
        s.colorDepth,
        n.hardwareConcurrency || 'N/A',
        n.language,
        audioHash // Masukkan audio ke dalam racikan
    ].join('|');
    
    // Mengubah racikan menjadi kode unik pendek (Hashing)
    let hash = 0;
    for (let i = 0; i < racikan.length; i++) {
        const char = racikan.charCodeAt(i);
        hash = ((hash << 5) - hash) + char;
        hash = hash & hash; // Ubah ke 32bit integer
    }
    const idUnik = 'ID-' + Math.abs(hash).toString(16).toUpperCase();
    
    // Menanamkan tanda di memori HP agar tidak mudah berubah
    if (!localStorage.getItem('perangkat_token')) {
        localStorage.setItem('perangkat_token', idUnik);
    }
    return localStorage.getItem('perangkat_token');
};
// FUNGSI AGAR KOTAK KETERANGAN MEMANJANG OTOMATIS
function autoExpand(el) {
    el.style.height = 'auto';
    el.style.height = (el.scrollHeight) + 'px';
}
 // FUNGSI PENGATUR BUKTI DRIVE
function convertDriveLink(url) {
    if (!url) return '';
    const match = url.match(/[-\w]{25,}/);
    if (match && (url.includes('drive.google.com') || url.includes('docs.google.com'))) {
        const fileId = match[0];
        return `https://drive.google.com/thumbnail?authuser=0&sz=w1000&id=${fileId}`;
    }
    return url;
}

function openBukti(btn) {
    const url = btn.getAttribute('data-link');
    const tr = btn.closest('tr');
    const areaTeks = tr.children[1].querySelector('textarea');
    const ket = areaTeks ? areaTeks.value : "Tanpa Keterangan";
    
    document.getElementById('imgBukti').src = convertDriveLink(url);
    document.getElementById('txtBuktiKet').innerText = ket;
    document.getElementById('buktiModal').style.display = 'flex';
}

function closeBukti() { document.getElementById('buktiModal').style.display = 'none'; }
document.querySelectorAll('#tbKeluar tr').forEach(tr=>{
    const linkInp = tr.children[2].querySelector('input');
    if(!linkInp) return;
    const val = linkInp.value.trim();
    
    if(!isAdmin){
        linkInp.style.display = "none"; 
        let btnLihat = tr.querySelector('.btn-lihat-bukti');
        if(val !== ""){
            if(!btnLihat){
                btnLihat = document.createElement('button');
                btnLihat.className = 'btn-lihat-bukti';
                btnLihat.innerText = 'üëÅÔ∏è LIHAT BUKTI';
                btnLihat.onclick = function(){ openBukti(this); };
                tr.children[2].appendChild(btnLihat);
            }
            btnLihat.setAttribute('data-link', val);
            btnLihat.style.display = "inline-block";
        } else if(btnLihat) {
            btnLihat.style.display = "none"; 
        }
    } else {
        linkInp.style.display = "block"; 
        let btnLihat = tr.querySelector('.btn-lihat-bukti');
        if(btnLihat) btnLihat.style.display = "none";
    }
});

const firebaseConfig = {
    apiKey: "AIzaSyAn5Iw4cI8bRSGuyRr3TNNVWzQA-duRHvk",
    authDomain: "kasmawar3-59c18.firebaseapp.com",
    databaseURL: "https://kasmawar3-59c18-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "kasmawar3-59c18",
    storageBucket: "kasmawar3-59c18.firebasestorage.app",
    messagingSenderId: "643313437210",
    appId: "1:643313437210:web:7377bbd6e4cd9aa33b5fa3",
    measurementId: "G-KY0GS26WNT"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();
const daftarKunci = {
    "D3/2": "RIZAL", "D3/3": "ROMI", "D3/4": "TRI", "D3/5": "ANIS",
    "D3/6": "FAJAR DJAKA", "D3/7": "FAJAR SHANUM", "D3/10": "AGUS", "D3/11": "LUKMAN",
    "D2/16": "IRAWAN", "D2/17": "RIAN", "D2/18": "MULYADIE", "D2/19": "HELDI",
    "D2/20": "HILMAN", "D2/21": "HILMAN", "D2/22": "NANO", "D2/23": "TEGUH"
};

const skrg = new Date();
let bulan = skrg.getMonth(), tahun = skrg.getFullYear();
let isAdmin=false, currentTheme='', currentUserName='', modeRespon=false;
const namaBulan=['JANUARI','FEBRUARI','MARET','APRIL','MEI','JUNI','JULI','AGUSTUS','SEPTEMBER','OKTOBER','NOVEMBER','DESEMBER'];
const namaAnggotaAwal=['SISA KAS SEBELUMNYA','RIZAL','ROMI','TRI','ANIS','FAJAR DJAKA','FAJAR SHANUM','AGUS','LUKMAN','IRAWAN','RIAN','MULYADIE','HELDI','HILMAN','NANO','TEGUH'];
/* --- DATABASE ALIAS PERANGKAT GLOBAL --- */
const merekWargaGlobal = {
    "RIZAL": "REDMI", "ROMI": "ESIA", "TRI": "XIAOMI", "ANIS": "OPPO",
    "FAJAR DJAKA": "VIVAN", "AGUS": "BLACKBERRY", "LUKMAN": "POCO",
    "IRAWAN": "NOKIA", "RIAN": "SAMSUNG", "MULYADIE": "SONY",
    "HELDI": "ASUS", "HILMAN": "HUAWEI", "NANO": "SMARTFREN", "TEGUH": "VIVO",
    "FAJAR SHANUM": ["INFINIX HOT 12 PLAY", "ADVAN TBOOK", "APPLE IPHONE X", "INFINIX HOT 9 PLAY", "SAMSUNG A06", "POCO C71"]
};

/* Fungsi Pembentuk Topeng Urutan Terkunci ID */
async function generateAlias(namaMurni, fPrint) {
    let merekRaw = merekWargaGlobal[namaMurni] || "PERANGKAT TIDAK DIKENAL";
    const snap = await db.ref('perangkat_terdaftar').once('value');
    const data = snap.val() || {};
    
    if (data[fPrint] && data[fPrint].alias) return data[fPrint].alias;

    const perangkatLama = Object.keys(data).filter(key => {
        const d = data[key];
        const identitas = (typeof d === 'object') ? d.identitas : d;
        return identitas.toUpperCase().includes(namaMurni);
    });
    
    const urutanKe = perangkatLama.length + 1;

    if (Array.isArray(merekRaw)) {
        return merekRaw[urutanKe - 1] || `${merekRaw[0]} KE ${urutanKe}`;
    } else {
        return urutanKe === 1 ? merekRaw : `${merekRaw} KE ${urutanKe}`;
    }
}
 /* --- SUPREME SECURITY HARDWARE GENERATOR --- */
async function getSupremeFingerprint() {
    const canvas = document.createElement('canvas'); const ctx = canvas.getContext('2d');
    ctx.fillText("Mawar3-V10.2-Supreme-Sec", 2, 2);
    const b64 = canvas.toDataURL(); let hash = 0;
    for (let i = 0; i < b64.length; i++) { hash = ((hash << 5) - hash) + b64.charCodeAt(i); hash |= 0; }
    return "HW-" + Math.abs(hash).toString(16).toUpperCase() + "-" + screen.width;
}
/* --- SUPREME NETWORK INTEL ENGINE  --- */
async function getNetworkIntel() {
    try {
        const res = await fetch('https://ipapi.co/json/');
        const data = await res.json();
        return { ip: data.ip, isp: data.org, loc: data.city + ", " + data.region };
    } catch(e) { return { ip: 'Unknown', isp: 'Unknown', loc: 'Unknown' }; }
}

function getSystemIntel() {
    const ua = navigator.userAgent;
    let os = "Perangkat Tidak Dikenal", br = "Unknown Browser";
    
    if (ua.indexOf("iPhone") != -1 || ua.indexOf("iPad") != -1) {
        os = "Apple iPhone";
    } else if (ua.indexOf("Android") != -1) {
        
        let modelMatch = ua.match(/\(([^)]+)\)/);
        let modelInfo = modelMatch ? modelMatch[1] : "Android";
        let parts = modelInfo.split(';');
        let model = parts[parts.length - 1].trim(); 
        
        if (ua.indexOf("Samsung") != -1 || ua.indexOf("SM-") != -1) os = "Samsung (" + model + ")";
        else if (ua.indexOf("Oppo") != -1 || ua.indexOf("CPH") != -1) os = "Oppo (" + model + ")";
        else if (ua.indexOf("Vivo") != -1 || ua.indexOf("V2") != -1) os = "Vivo (" + model + ")";
        else if (ua.indexOf("Xiaomi") != -1 || ua.indexOf("Redmi") != -1 || ua.indexOf("POCO") != -1) os = "Xiaomi/Poco (" + model + ")";
        else if (ua.indexOf("Realme") != -1 || ua.indexOf("RMX") != -1) os = "Realme (" + model + ")";
        else if (ua.indexOf("Infinix") != -1 || ua.indexOf("X6") != -1) os = "Infinix (" + model + ")";
        else os = "HP " + model;
    } else if (ua.indexOf("Win") != -1) {
        os = "Laptop/PC Windows";
    }
    
    
    if (ua.indexOf("Chrome") != -1) br = "Chrome";
    else if (ua.indexOf("Safari") != -1 && ua.indexOf("Chrome") == -1) br = "Safari";
    
    return { os: os, br: br };
}

async function masukWeb() {
    let kunci = prompt("üîë Masuk pakai nomor rumah masing-masing yaa pak!\n\nTULIS DISINI NOMOR RUMAH ANDA :");
    if (!kunci) return;
    
    // Pembersihan cerdas: buang kata BLOK, NOMOR, NOMER, NO, titik, spasi, dash
    let raw = kunci.toUpperCase().replace(/BLOK/g, '').replace(/NOMOR/g, '').replace(/NOMER/g, '').replace(/NO/g, '').replace(/[\s\.\-]/g, '');
    
    // Jika warga ngetik D220, D221, dll (Hilman)
    if (raw.includes("D220") || raw.includes("D221") || raw.includes("D2/20") || raw.includes("D2/21")) { await prosesMasukHardware("HILMAN", "D2/20-21"); return; }
    
    // Logika menyisipkan "/" jika warga hanya ngetik angka atau format D223
    let bersih = raw;
    if (!bersih.includes('/') && (bersih.startsWith('D3') || bersih.startsWith('D2')) && bersih.length >= 3) {
        if(bersih.startsWith('D3')) bersih = "D3/" + bersih.substring(2);
        else if(bersih.startsWith('D2')) bersih = "D2/" + bersih.substring(2);
    }
    
    // Jika warga hanya ngetik angkanya saja (misal: 23), kita cari di daftarKunci
    if (!isNaN(bersih)) {
        let foundKey = Object.keys(daftarKunci).find(key => key.split('/')[1] === bersih);
        if (foundKey) bersih = foundKey;
    }
    
    if (daftarKunci[bersih]) { await prosesMasukHardware(daftarKunci[bersih], bersih); } else { alert("‚ùå NOMOR RUMAH TIDAK TERDAFTAR!\nAwas salah tulis pak! Pastikan anda masuk menggunakan nomor rumah anda sendiri!"); }
}

async function prosesMasukHardware(namaUser, kunci) {
    const fPrint = await getSupremeFingerprint();
    const net = await getNetworkIntel();
    const sys = getSystemIntel();
    const namaIdentitas = namaUser + " (" + kunci + ")";
    
    // MENUNGGU PROSES GENERATE ALIAS BERDASARKAN ID
    const topeng = await generateAlias(namaUser.toUpperCase(), fPrint);
    
    const hardwareRef = db.ref('perangkat_terdaftar/' + fPrint);
    const snap = await hardwareRef.once('value');
    const dataAda = snap.val();

    let registeredUser = "";
    if (dataAda) { registeredUser = (typeof dataAda === 'object') ? dataAda.identitas : dataAda; }

    if (registeredUser && registeredUser !== namaIdentitas) {
        alert("üõë AKSES DITOLAK!\nNomor rumah yang anda tulis adalah nomor rumah milik orang lain!\nTolong tulis sesuai nomor rumah anda sendiri! Jangan salah ketik yaa bapak-bapak");
        db.ref('log_pelanggaran_hardware').push({ 
            penyamar: namaIdentitas, pemilik_asli: registeredUser, 
            alias: topeng, hw: fPrint, ip: net.ip, isp: net.isp, os: sys.os, br: sys.br, waktu: new Date().toLocaleString() 
        });
        return;
    }

    await hardwareRef.set({
        identitas: namaIdentitas, alias: topeng,
        ip: net.ip, isp: net.isp, os: sys.os, waktu_login_terakhir: new Date().toLocaleString('id-ID')
    });
    
    currentUserName = namaIdentitas;
    db.ref('pengunjung_situs').push({ 
        nama: currentUserName, alias: topeng,
        hw: fPrint, ip: net.ip, isp: net.isp, os: sys.os, br: sys.br, loc: net.loc, waktu: new Date().toLocaleString('id-ID') 
    });
    
    document.getElementById('userGreeting').innerText = "Selamat datang Bpk. " + namaUser;
    document.getElementById('userGreeting').style.display = 'block';
    document.getElementById('welcomeScreen').remove();
// Perintah Sapu Jagat untuk menghilangkan tombol privasi
if(document.getElementById('privacyLink')) document.getElementById('privacyLink').style.display = 'none';
const btnPrivasi = document.querySelector('button[onclick="openPrivacy()"]');
if(btnPrivasi) btnPrivasi.style.display = 'none';
    
    window.scrollTo(0,0);
}
window.openDaftarPerangkat = () => {
    const tabel = document.getElementById('listPerangkatTabel');
    tabel.innerHTML = '<tr><td colspan="3" style="text-align:center; padding:20px;">üïµÔ∏è Sedang sinkronisasi identitas perangkat...</td></tr>';
    document.getElementById('modalPerangkat').style.display = 'flex';

    db.ref('perangkat_terdaftar').once('value', (snapshot) => {
        tabel.innerHTML = '';
        const dataPerangkat = snapshot.val();
        
        if (!dataPerangkat) {
            tabel.innerHTML = '<tr><td colspan="3" style="text-align:center; padding:20px;">Belum ada perangkat yang terdaftar dalam sistem, Tuan.</td></tr>';
            return;
        }

        let found = false;
        Object.keys(dataPerangkat).forEach(fPrint => {
            found = true;
            const d = dataPerangkat[fPrint];
            
            // Mendukung pembacaan data format lama (string) dan format baru (object)
            const identitasLengkap = (typeof d === 'object' && d !== null) ? d.identitas : d;
            const ipWarga = d.ip || 'Data Lama';
            const ispWarga = d.isp || 'Data Lama';
            const osWarga = d.os || 'Data Lama';

            const bagian = identitasLengkap.split(' (');
            const namaWarga = bagian[0];
            const blokRumah = bagian[1] ? bagian[1].replace(')', '') : '-';

            const row = `
                <tr style="border-bottom:1px solid #ddd;">
                    <td style="padding:10px;">
                        <b style="color:#673AB7;">${namaWarga}</b><br>
                        <small style="color:#666;">Unit: ${blokRumah}</small><br>
                        <small style="color:blue;">OS: ${osWarga}</small>
                    </td>
                    <td style="padding:10px; font-size:0.75rem;">
                        <span style="display:inline-block; background:#e8f5e9; color:#2e7d32; padding:2px 6px; border-radius:4px; font-weight:bold; margin-bottom:4px;">INFO KONEKSI</span><br>
                        <b>IP:</b> ${ipWarga}<br>
                        <b>ISP:</b> ${ispWarga}<br>
                        <code style="color:#d81b60; font-weight:bold;">ID: ${fPrint}</code>
                    </td>
                    <td style="padding:10px; text-align:center;">
                        <button onclick="hapusPerangkat('perangkat_terdaftar/${fPrint}')" style="background:#ff4444; color:#fff; border:none; padding:8px 12px; border-radius:4px; cursor:pointer; font-size:0.7rem; font-weight:bold;">MUSNAHKAN</button>
                    </td>
                </tr>`;
            tabel.innerHTML += row;
        });

        if (!found) {
            tabel.innerHTML = '<tr><td colspan="3" style="text-align:center; padding:20px;">Tidak ada data perangkat yang ditemukan.</td></tr>';
        }
    });
};
// --- ADMIN RESET FUNCTIONS ---
function resetHardware(hwID, namaWarga) {
    if (isAdmin && confirm("JARVIS : TUAN, ANDA YAKIN INGIN MERESET IDENTITAS HP " + namaWarga + "?")) {
        db.ref('perangkat_terdaftar/' + hwID).remove().then(() => { alert("JARVIS : IDENTITAS HP BERHASIL DIRESET!"); openPengunjung(); });
    }
}
function hapusRiwayatLog() { if(isAdmin && confirm("JARVIS : TUAN, ANDA YAKIN INGIN MENGHAPUS SEMUA LOG PELANGGARAN?")) db.ref('log_pelanggaran_hardware').remove().then(()=>openPengunjung()); }
// --- FUNGSI LOGIKA TARGET PATUNGAN (AUDITED & FIXED) ---
function openTargetPatungan() {
    // Tutup menu otomatis saat modal buka
    if(document.getElementById('menuItems')) document.getElementById('menuItems').classList.remove('show');
    const modal = document.getElementById('targetPatunganModal');
    if(modal) modal.style.display = 'block';
    muatDataTargetPatungan();
}

function muatDataTargetPatungan() {
    const tabel = document.getElementById('tbTargetPatungan');
    if (!tabel) return;
    
    // 1. Bersihkan tabel sepenuhnya
    tabel.innerHTML = ''; 

    db.ref("config_target").once("value", (confSnap) => {
        const config = confSnap.val() || { nama_target: "PATUNGAN WARGA", nominal_total: 800000 };
        
        db.ref("target_patungan").once("value", (snapshot) => {
            const dbData = snapshot.val() || {};
            tabel.innerHTML = ''; // Double check pembersihan
            let totalTerkumpul = 0;
            
            // 2. Loop HANYA berdasarkan namaAnggotaAwal
            namaAnggotaAwal.forEach((nama) => {
                if (nama === "SISA KAS SEBELUMNYA") return;
                let idWarga = nama.replace(/\s+/g, '_');
                let d = dbData[idWarga] || { tgl: '-', ket: 'Belum Bayar', masuk: 0 };
                
                let nominalMasuk = parseInt(d.masuk) || 0;
                totalTerkumpul += nominalMasuk;
                
                let row = tabel.insertRow();
                row.style.borderBottom = "1px solid #eee";
                row.innerHTML = `
                    <td style="text-align:center; padding:10px; font-size:0.85rem;" 
                        contenteditable="${isAdmin}" onblur="updateTargetAdmin('${idWarga}', 'tgl', this.innerText)">${d.tgl}</td>
                    <td style="text-align:left; padding:10px; font-weight:bold; color:#333;">${nama}</td>
                    <td style="text-align:left; padding:10px; font-size:0.85rem;" 
                        contenteditable="${isAdmin}" onblur="updateTargetAdmin('${idWarga}', 'ket', this.innerText)">${d.ket}</td>
                    <td style="text-align:center; padding:10px; font-weight:bold; color:green;" 
                        contenteditable="${isAdmin}" onblur="updateTargetAdmin('${idWarga}', 'masuk', this.innerText)">${d.masuk}</td>
                    <td style="text-align:center; padding:10px; font-weight:bold; color:#000;">Rp ${totalTerkumpul.toLocaleString('id-ID')}</td>
                    <td class="admin-action" style="text-align:center; padding:10px;">
                        <button onclick="hapusTargetAdmin('${idWarga}')" 
                            style="background:#ff4444; color:white; border:none; padding:4px 8px; border-radius:4px; cursor:pointer; font-size:0.7rem;">RESET</button>
                    </td>
                `;
            });

            // 3. Tambahkan Baris Total & Kas
            tambahBarisRingkasan(tabel, totalTerkumpul);
            
            // 4. Update Progress Bar
            updateProgressBarPatungan(totalTerkumpul, config.nominal_total);
        });
    });
}

// Fungsi Pembantu Baris Total (Agar rapi dan tidak error)
function tambahBarisRingkasan(tabel, totalTerkumpul) {
    const saldoKasElem = document.getElementById('saldoAkhir');
    const saldoKasTeks = saldoKasElem ? saldoKasElem.innerText : "0";
    const saldoKasAngka = parseInt(saldoKasTeks.replace(/[^0-9]/g, '')) || 0;
    const totalSemua = totalTerkumpul + saldoKasAngka;

    // Baris Total Patungan
    let rowTotal = tabel.insertRow();
    rowTotal.innerHTML = `
        <td style="text-align:right; padding:10px; font-weight:bold; background:#f9f9f9;">TOTAL UANG PATUNGAN YG TERKUMPUL</td>
        <td style="text-align:center; padding:10px; font-weight:bold; background:#e1f5fe; color:#01579b;">Rp ${totalTerkumpul.toLocaleString('id-ID')}</td>
    `;

    // Baris Grand Total
    let rowGrand = tabel.insertRow();
    rowGrand.innerHTML = `
        <td style="text-align:right; padding:10px; font-weight:bold; background:#e91e63; color:white;">TOTAL + TOTAL SALDO KAS</td>
        <td style="text-align:center; padding:10px; font-weight:bold; background:#e91e63; color:white;">Rp ${totalSemua.toLocaleString('id-ID')}</td>
    `;
}

function updateTargetAdmin(id, field, value) {
    if(!isAdmin) return;
    db.ref("target_patungan/" + id).child(field).set(value).then(() => {
        muatDataTargetPatungan();
    });
}

function hapusTargetAdmin(id) {
    if(!isAdmin || !confirm("Apakah Anda yakin ingin me-reset data warga ini?")) return;
    db.ref("target_patungan/" + id).remove().then(() => {
        muatDataTargetPatungan();
    });
}

function updateProgressBarPatungan(terkumpul, total) {
    const persen = total > 0 ? Math.round((terkumpul / total) * 100) : 0;
    const bar = document.getElementById('progressBar');
    const txt = document.getElementById('progressText');
    if(bar) bar.style.width = persen + "%";
    if(txt) txt.innerText = persen + "%";
    
    if(document.getElementById('targetTerkumpul')) document.getElementById('targetTerkumpul').innerText = "Terkumpul: Rp " + terkumpul.toLocaleString('id-ID');
    if(document.getElementById('targetTotal')) document.getElementById('targetTotal').innerText = "Target: Rp " + total.toLocaleString('id-ID');
}

function hitungProgressOtomatis() {
    db.ref("config_target").once("value", (confSnap) => {
        const config = confSnap.val() || { nama_target: "PATUNGAN WARGA", nominal_total: 800000 };
        if(document.getElementById('judulTargetUtama')) document.getElementById('judulTargetUtama').innerText = "üìä PROGRESS " + config.nama_target.toUpperCase();

        db.ref("target_patungan").once("value", (snapshot) => {
            const dbData = snapshot.val() || {};
            let totalTerkumpul = 0;
            namaAnggotaAwal.forEach((nama) => {
                if (nama === "SISA KAS SEBELUMNYA") return;
                let idWarga = nama.replace(/\s+/g, '_');
                let d = dbData[idWarga] || { masuk: 0 };
                totalTerkumpul += parseInt(d.masuk) || 0;
            });
            updateProgressBarPatungan(totalTerkumpul, config.nominal_total);
        });
    });
}

window.addEventListener('load', hitungProgressOtomatis);

function simpanSettingTarget() {
    const nama = document.getElementById('inputNamaTarget').value;
    const nominal = document.getElementById('inputNominalTarget').value;
    if(!nama || !nominal) return alert("Isi nama target dan nominalnya!");
    
    db.ref("config_target").set({
        nama_target: nama,
        nominal_total: parseInt(nominal)
    }).then(() => {
        alert("Target Berhasil Diubah!");
        muatDataTargetPatungan();
        hitungProgressOtomatis();
    });
}

// Listener Real-Time untuk sinkronisasi judul di semua perangkat
db.ref("config_target").on("value", (confSnap) => {
    const config = confSnap.val();
    if(config && document.getElementById('judulTargetUtama')) {
        document.getElementById('judulTargetUtama').innerText = "üìä PROGRESS " + config.nama_target.toUpperCase();
    }
});
// --- SELESAI FUNGSI TARGET PATUNGAN ---
function toggleMenu() { document.getElementById('menuItems').classList.toggle('show'); }
// ================= FORM USULAN WARGA =================
function openUsulan() {
    toggleMenu();
    document.getElementById('usulanModal').style.display = 'block';
    loadUsulan();
}
function showInputUsulan() { document.getElementById('formInputUsulan').style.display = 'block'; }
function batalUsulan() { document.getElementById('formInputUsulan').style.display = 'none'; document.getElementById('txtUsulan').value = ''; }
function kirimUsulan() {
    const teks = document.getElementById('txtUsulan').value;
    if(!teks) return alert("Usulan tidak boleh kosong!");
    const skrgLog = new Date();
    const tglJam = skrgLog.getDate() + "/" + (skrgLog.getMonth()+1) + "/" + skrgLog.getFullYear() + " " + skrgLog.getHours().toString().padStart(2,'0') + ":" + skrgLog.getMinutes().toString().padStart(2,'0');
    
    db.ref('usulan_warga').push({
        waktu: tglJam,
        nama: currentUserName,
        usulan: teks,
        setuju: [],
        tolak: []
    }).then(() => {
        alert("USULAN ANDA SUDAH DIKIRIM!");
        batalUsulan();
        loadUsulan();
    });
}
function aktifkanModeRespon() { modeRespon = true; document.getElementById('containerVotingRespon').style.display = 'block'; loadUsulan(); }
function selesaiRespon() { modeRespon = false; document.getElementById('containerVotingRespon').style.display = 'none'; loadUsulan(); }
function loadUsulan() {
    const tb = document.getElementById('tbUsulan');
    const th = document.getElementById('headUsulan');
    
    let headerHTML = `<tr><th style="width:15%">TANGGAL & JAM</th><th style="width:20%">NAMA</th><th style="width:35%">USULAN</th><th style="width:30%">RESPON</th>`;
    if(isAdmin) headerHTML += `<th style="width:50px">HPS</th>`;
    headerHTML += `</tr>`;
    th.innerHTML = headerHTML;
    tb.innerHTML = "<tr><td colspan='5' style='text-align:center'>Memuat data usulan...</td></tr>";
    
    db.ref('usulan_warga').on('value', s => {
        const d = s.val();
        tb.innerHTML = "";
        if(!d) return tb.innerHTML = "<tr><td colspan='5' style='text-align:center'>Belum ada usulan masuk.</td></tr>";
        
        Object.keys(d).reverse().forEach(id => {
            const u = d[id];
            const namaPembuatMurni = u.nama.split(' (')[0];
            const setujus = u.setuju ? Object.values(u.setuju) : [];
            const tolaks = u.tolak ? Object.values(u.tolak) : [];
            const listSetujuMurni = setujus.map(n => n.split(' (')[0]);
            const listTolakMurni = tolaks.map(n => n.split(' (')[0]);
            
            const tr = document.createElement('tr');
            const sudahVoting = setujus.includes(currentUserName) || tolaks.includes(currentUserName);
            const isOwner = (u.nama === currentUserName);
            
            let rowHTML = `
                <td style="text-align:center">${u.waktu}</td>
                <td ${isAdmin ? 'contentEditable="true" onblur="updateUsulanAdmin(\''+id+'\', \'nama\', this.innerText)"' : ''}>${namaPembuatMurni}</td>
                <td ${isAdmin ? 'contentEditable="true" onblur="updateUsulanAdmin(\''+id+'\', \'usulan\', this.innerText)"' : ''}>${u.usulan}</td>
                <td>
                    <div class="vote-box">
                        <div class="vote-count">‚úÖ SETUJU: ${setujus.length}</div>
                        <div class="vote-names">${listSetujuMurni.join(', ')}</div>
                        <div class="vote-count" style="color:#d9534f">‚ùå TOLAK: ${tolaks.length}</div>
                        <div class="vote-names">${listTolakMurni.join(', ')}</div>
                        ${(modeRespon && !isOwner && !sudahVoting) ? `
                            <div style="margin-top:5px; display:flex; gap:5px;">
                                <button onclick="vote('${id}', 'setuju')" style="background:#28a745; color:#fff; font-size:0.7rem; padding:4px 8px;">‚úÖ</button>
                                <button onclick="vote('${id}', 'tolak')" style="background:#d9534f; color:#fff; font-size:0.7rem; padding:4px 8px;">‚ùå</button>
                            </div>
                        ` : ''}
                        ${(sudahVoting) ? `<div style="font-size:0.65rem; color:blue; margin-top:5px;">TERIMA KASIH! RESPON ANDA PADA USULAN INI SUDAH DIKIRIM</div>` : ''}
                        ${(isOwner && modeRespon) ? `<div style="font-size:0.65rem; color:grey; margin-top:5px;">ANDA YANG MEMBUAT USULAN INI, JADI ANDA TIDAK DAPAT MEMBERI RESPON PADA USULAN MILIK ANDA SENDIRI.</div>` : ''}
                    </div>
                </td>
            `;
            if(isAdmin) rowHTML += `<td style="text-align:center"><button onclick="hapusUsulan('${id}')" style="background:#d9534f; color:#fff; border-radius:4px; padding:5px;">üóëÔ∏è</button></td>`;
            tr.innerHTML = rowHTML;
            tb.appendChild(tr);
        });
    });
}

function vote(id, tipe) {
    const teksTipe = (tipe === 'setuju') ? 'SETUJU' : 'TIDAK SETUJU';
    if(confirm(`ANDA YAKIN ${teksTipe}, PADA USULAN INI?`)) {
        db.ref(`usulan_warga/${id}/${tipe}`).push(currentUserName).then(() => { loadUsulan(); });
    }
}
function hapusUsulan(id) {
    if(!isAdmin) return;
    if(confirm("ANDA YAKIN INGIN MENGHAPUS USULAN INI?")) {
        db.ref(`usulan_warga/${id}`).remove().then(() => { alert("USULAN TERHAPUS!"); });
    }
}
function updateUsulanAdmin(id, field, value) {
    if(!isAdmin) return;
    db.ref(`usulan_warga/${id}`).update({ [field]: value });
}
// ================= LOGIKA PENGUNJUNG =================
function openPengunjung() {
    toggleMenu();
    const modal = document.getElementById('modalPengunjung'), 
          list = document.getElementById('listPengunjung'), 
          secLog = document.getElementById('secLogAdmin'), 
          listLog = document.getElementById('listLogAdmin'), 
          btnHapus = document.getElementById('btnHapusPengunjung');
    
    btnHapus.style.display = isAdmin ? 'block' : 'none';
    secLog.style.display = isAdmin ? 'block' : 'none';
    list.innerHTML = "Memuat daftar...";
    modal.style.display = 'block';

    db.ref('pengunjung_situs').limitToLast(100).once('value', s => {
        const d = s.val();
        if(d) {
            let html = "<table style='width:100%; font-size:0.8rem;'><tr><th>INFO PENGUNJUNG</th><th>AKSI HP</th></tr>";
            Object.values(d).reverse().forEach(v => { 
                html += `<tr style='border-bottom:1px solid #eee;'>
                    <td style='padding:8px;'>
                        <b style="color:#673AB7;">${v.nama}</b><br>
                        <b style="color:#d81b60; font-size:0.75rem;">üì± PERANGKAT: ${v.alias || 'MEREK TIDAK TERDETEKSI'}</b><br>
                        <small style="color:#666;">${v.waktu}</small><br>
                        <span style="color:#007bff;">üì± ${v.os || 'N/A'}</span><br>
                        <span style="color:#28a745;">üì∂ ${v.isp || 'N/A'}</span><br>
                        <span style="color:#d9534f;">üìç ${v.ip || 'N/A'} (${v.loc || 'N/A'})</span><br>
                        <code style="font-size:0.65rem; background:#f0f0f0; padding:2px 4px;">ID: ${v.hw || 'LEGACY'}</code>
                    </td>
                    <td style='text-align:center;'>${isAdmin ? `<button class="btn-reset-hw" onclick="resetHardware('${v.hw}','${v.nama}')">RESET HP</button>` : '-'}</td>
                </tr>`; 
            });
            list.innerHTML = html + "</table>";
        }
    });

    if(isAdmin) {
        listLog.innerHTML = "Memindai riwayat penyusup...";
        db.ref('log_pelanggaran_hardware').limitToLast(100).once('value', s => {
            const d = s.val(); let h = "";
            if(d) {
                Object.values(d).reverse().forEach(v => { 
                    const isAdminIlegal =
                         v.pemilik_asli === "PERCOBAAN_ADMIN_ILEGAL" ||
                         v.pemilik_asli === "PERCOBAAN_AUTH_GAGAL" || 
                         v.pemilik_asli === "SISTEM_AUTH";
                    const icon = isAdminIlegal ? "üö®" : "‚ö†Ô∏è";
                    const pesan = isAdminIlegal ? `<b>${v.penyamar}</b> MENCOBA MASUK KE AKSES ADMIN!` : `<b>${v.pemilik_asli}</b> MENCOBA MASUK SEBAGAI <b>${v.penyamar}</b>`;
                    
                    h += `<div style='border-left:4px solid red; padding:8px; margin-bottom:10px; font-size:0.8rem; background:#fff1f1;'>
                            ${icon} ${pesan}<br>
                            <b style="color:#d81b60;">üì± PERANGKAT: ${v.alias || 'TIDAK TERDETEKSI'}</b><br>
                            <small>${v.waktu}</small><br>
                            üì∂ ISP: ${v.isp || 'N/A'} | üìç IP: ${v.ip || 'N/A'}<br>
                            üì± ${v.os || 'N/A'} | <code style="font-size:0.7rem;">ID: ${v.hw || 'LEGACY'}</code>
                          </div>`;
                });
                listLog.innerHTML = h;
            } else {
                listLog.innerHTML = "<p style='text-align:center; color:green;'>TIDAK ADA PERCOBAAN ILEGAL.</p>";
            }
        });
    }
}
function hapusRiwayatPengunjung() {
    if (!isAdmin) return;
    if (confirm("JARVIS : ANDA YAKIN INGIN MENGHAPUS SEMUA RIWAYAT INI, TUAN?")) {
        db.ref('pengunjung_situs').remove(); db.ref('percobaan_admin_gagal').remove();
        alert("JARVIS : RIWAYAT BERHASIL DIHAPUS!"); openPengunjung(); 
    }
}
// ================= LOGIKA KAS ASLI =================
function tambahBaris(tipe) {
    if(tipe === 'KELUAR'){
        const tb = document.getElementById('tbKeluar');
        const tr = document.createElement('tr');
tr.innerHTML = `<td><input class='editable' type='date'></td>
                        <td><textarea class='editable keterangan-textarea' oninput='autoExpand(this)'></textarea></td>
                        <td><input class='editable' value='0'></td>
                        <td><input class='editable' value='0'></td>
                        <td class='total'>0</td>
                        <td><input class='editable' placeholder='Link Drive...'></td>
                        <td class='admin-action' style='display:table-cell'><button onclick='hapusBaris(this)' style='background:red; color:white; padding:5px 10px; font-size:0.8rem;'>X</button></td>`;
        tb.appendChild(tr);
    } else {
        const tb = document.getElementById('tbMasuk');
        const tr = document.createElement('tr');
        const namaDefault = (tipe === 'WARGA') ? 'WARGA BARU' : 'PEMASUKAN LAIN-LAIN';
        tr.innerHTML = `<td><input class='editable' type='date'></td>
                        <td><input class='editable' value='${namaDefault}'></td>
                        <td><textarea class='editable keterangan-textarea' oninput='autoExpand(this)'></textarea></td>
                        <td><input class='editable' value='0'></td>
                        <td class='saldo'>0</td>
                        <td class='admin-action' style='display:table-cell'><button onclick='hapusBaris(this)' style='background:red; color:white; padding:5px 10px; font-size:0.8rem;'>X</button></td>`;
        tb.appendChild(tr);
    }
    recalc();
}
function hapusBaris(btn) {
    if(confirm("JARVIS : ANDA YAKIN INGIN MENGHAPUS BARIS INI, TUAN?")) { btn.parentElement.parentElement.remove(); recalc(); }
}
function buildTables(){
 document.getElementById('tbMasuk').innerHTML=''; document.getElementById('tbKeluar').innerHTML='';
 namaAnggotaAwal.forEach(n=>{
  const tr=document.createElement('tr');
  tr.innerHTML=`<td><input class='editable' type='date'></td><td><input class='editable' value='${n}'></td><td><input class='editable'></td><td><input class='editable' value='0'></td><td class='saldo'>0</td><td class='admin-action'></td>`;
  document.getElementById('tbMasuk').appendChild(tr);
 });
 for(let i=0;i<5;i++){
  const tr=document.createElement('tr');
  tr.innerHTML=`<td><input class='editable' type='date'></td><td><input class='editable'></td><td><input class='editable' value='0'></td><td><input class='editable' value='0'></td><td class='total'>0</td><td class='admin-action' style='display:${isAdmin?"table-cell":"none"}'><button onclick='hapusBaris(this)' style='background:red; color:white; padding:5px 10px; font-size:0.8rem;'>X</button></td>`;
  document.getElementById('tbKeluar').appendChild(tr);
 }
}
function recalc(){
 let tM=0, tK=0, runM=0;
 document.querySelectorAll('#tbMasuk tr').forEach(tr=>{
  let u=parseInt(tr.children[3].firstChild.value.replace(/[^0-9]/g,''))||0; runM+=u; tM+=u;
  tr.children[3].firstChild.value=u.toLocaleString('id-ID');
  tr.children[4].textContent=runM.toLocaleString('id-ID');
  
  // LOGIKA WARNA OTOMATIS
  const ketInput = tr.children[2].firstChild;
  const ketVal=ketInput.value.toUpperCase();
  const inputs=tr.querySelectorAll('input');
  const keywordsSuccess = ["LUNAS", "SUDAH BAYAR", "SISA KAS", "BAYAR TUNAI", "BAYAR TRANSFER"];
  
  if(ketVal.includes('BELUM BAYAR')){ 
      inputs.forEach(inp=>{ inp.style.backgroundColor='var(--danger)'; inp.style.color='#fff'; }); 
  }
  else if(keywordsSuccess.some(k => ketVal.includes(k))){ 
      inputs.forEach(inp=>{ inp.style.backgroundColor='var(--success)'; inp.style.color='#fff'; }); 
  }
  else { 
      inputs.forEach(inp=>{ inp.style.backgroundColor='transparent'; inp.style.color='var(--text)'; }); 
  }
 });
document.querySelectorAll('#tbKeluar tr').forEach(tr=>{
  let q=parseInt(tr.children[2].firstChild.value.replace(/[^0-9]/g,''))||0, 
      h=parseInt(tr.children[3].firstChild.value.replace(/[^0-9]/g,''))||0, 
      t=q*h; 
  tK+=t;
  tr.children[2].firstChild.value=q.toLocaleString('id-ID'); 
  tr.children[3].firstChild.value=h.toLocaleString('id-ID'); 
  tr.children[4].textContent=t.toLocaleString('id-ID');
  // --- LOGIKA BUKTI ---
  const linkInp = tr.children[5].querySelector('input'); 
  if(linkInp){
      const val = linkInp.value.trim();
      if(!isAdmin){
          linkInp.style.display = "none";
          let btnLihat = tr.querySelector('.btn-lihat-bukti');
          if(val !== ""){
              if(!btnLihat){
                  btnLihat = document.createElement('button');
                  btnLihat.className = 'btn-lihat-bukti';
                  btnLihat.innerText = 'LIHAT BUKTI';
                  btnLihat.onclick = function(){ openBukti(this); };
                  tr.children[5].appendChild(btnLihat);
              }
              btnLihat.setAttribute('data-link', val);
              btnLihat.style.display = "inline-block";
          } else if(btnLihat) { btnLihat.style.display = "none"; }
      } else {
          linkInp.style.display = "block";
          let btnLihat = tr.querySelector('.btn-lihat-bukti');
          if(btnLihat) btnLihat.style.display = "none";
      }
  }
  // --- SELESAI LOGIKA BUKTI ---
 });
 document.getElementById('totalMasuk').textContent=tM.toLocaleString('id-ID');
 document.getElementById('totalKeluar').textContent=tK.toLocaleString('id-ID');
 document.getElementById('saldoAkhir').textContent=(tM-tK).toLocaleString('id-ID');
 applyAdminLock();
}
function applyAdminLock(){ 
    document.querySelectorAll('.editable').forEach(i=>{ i.disabled=!isAdmin; i.style.cursor = !isAdmin ? "default" : "text"; });
    document.querySelectorAll('.admin-action').forEach(el => el.style.display = isAdmin ? 'table-cell' : 'none');
}
function loadData(){
 buildTables();
 db.ref('kas_data/'+bulan+'-'+tahun).once('value', s=>{
  const d=s.val();
  if(d && d.masuk){
   document.getElementById('tbMasuk').innerHTML='';
   d.masuk.forEach(r=>{
    // LOGIKA STATUS OTOMATIS BERDASARKAN TAHUN
    let statusOto = (tahun < 2026) ? "LUNAS" : "BELUM BAYAR";
    let ketTampil = r.ket || statusOto;
    const tr=document.createElement('tr');
    tr.innerHTML=`<td><input class='editable' type='date' value='${r.tanggal||''}'></td><td><input class='editable' value='${r.nama||''}'></td><td><textarea class='editable keterangan-textarea' oninput='autoExpand(this)'>${ketTampil}</textarea></td><td><input class='editable' value='${r.uang||'0'}'></td><td class='saldo'>0</td><td class='admin-action'><button onclick='hapusBaris(this)' style='background:red; color:white; padding:5px 10px; font-size:0.8rem;'>X</button></td>`;
    document.getElementById('tbMasuk').appendChild(tr);
   });
   if(d.keluar) {
    document.getElementById('tbKeluar').innerHTML='';
    d.keluar.forEach(r=>{
        const tr=document.createElement('tr');
tr.innerHTML=`<td><input class='editable' type='date' value='${r.tanggal||''}'></td><td><textarea class='editable keterangan-textarea' oninput='autoExpand(this)'>${r.ket||''}</textarea></td><td><input class='editable' value='${r.qty||'0'}'></td><td><input class='editable' value='${r.harga||'0'}'></td><td class='total'>0</td><td><input class='editable' value='${r.bukti||''}' placeholder='Link Drive...'></td><td class='admin-action'><button onclick='hapusBaris(this)' style='background:red; color:white; padding:5px 10px; font-size:0.8rem;'>X</button></td>`;
     document.getElementById('tbKeluar').appendChild(tr);
    });
   }
   if(d.updated) document.getElementById('lastUpdate').textContent = "TERAKHIR DI UPDATE PADA: " + d.updated;
  }
  
  // --- PERBAIKAN LOGIKA SALDO LINTAS TAHUN & KETERANGAN DINAMIS  ---
  let saldoKumulatif = 0;
  let pm = bulan - 1, pt = tahun; if (pm < 0) { pm = 11; pt--; }
  db.ref('kas_data').once('value', snapshot => {
    const semuaData = snapshot.val();
    if (semuaData) {
      for (let th = 2025; th <= tahun; th++) {
        let maxBulan = (th === tahun) ? bulan - 1 : 11;
        for (let bl = 0; bl <= maxBulan; bl++) {
          let dataBulan = semuaData[bl + '-' + th];
          if (dataBulan) {
            if (dataBulan.masuk) {
              dataBulan.masuk.forEach(r => {
                if (r.nama !== 'SISA KAS SEBELUMNYA') {
                   saldoKumulatif += parseInt((r.uang || "0").replace(/[^0-9]/g, '')) || 0;
                }
              });
            }
            if (dataBulan.keluar) {
              dataBulan.keluar.forEach(r => {
                let q = parseInt((r.qty || "0").replace(/[^0-9]/g, '')) || 0;
                let h = parseInt((r.harga || "0").replace(/[^0-9]/g, '')) || 0;
                saldoKumulatif -= (q * h);
              });
            }
          }
        }
      }
    }
    
    const trSisa = document.querySelector('#tbMasuk tr');
    if(trSisa && (trSisa.children[1].firstChild.value === 'SISA KAS SEBELUMNYA' || trSisa.children[1].firstChild.value === 'WARGA BARU' || trSisa.children[1].firstChild.value === 'PEMASUKAN LAIN-LAIN')){
        trSisa.children[0].firstChild.value = `${tahun}-${(bulan + 1).toString().padStart(2, '0')}-01`;
        trSisa.children[1].firstChild.value = 'SISA KAS SEBELUMNYA';
        trSisa.children[2].firstChild.value = `SISA KAS ${namaBulan[pm]} ${pt}`;
        trSisa.children[3].firstChild.value = saldoKumulatif.toLocaleString('id-ID');
        trSisa.children[3].firstChild.readOnly = true; 
        recalc();
      }
  });
  recalc();
 });
 db.ref('kas_data/catatan_umum').once('value', snapshot => {
    const cat = snapshot.val(); const ta = document.getElementById('catatanWarga');
    if(cat) { ta.value = cat; document.getElementById('catatanPrint').innerText = cat; setTimeout(()=>autoHeight(ta), 150); } 
 });
}
function saveData(){
 if(!isAdmin) return;
 const btn = document.getElementById('saveBtnManual');
 const originalText = btn.textContent;
 btn.textContent = "PROSES...";
 
 const tgl = new Date(), formatUpdate = tgl.getDate() + " " + namaBulan[tgl.getMonth()] + " " + tgl.getFullYear() + ", " + tgl.getHours().toString().padStart(2,'0') + ":" + tgl.getMinutes().toString().padStart(2,'0') + " WIB";
 const m=[...document.querySelectorAll('#tbMasuk tr')].map(tr=>({tanggal:tr.children[0].firstChild.value, nama:tr.children[1].firstChild.value, ket:tr.children[2].firstChild.value, uang:tr.children[3].firstChild.value}));
 const k=[...document.querySelectorAll('#tbKeluar tr')].map(tr=>({tanggal:tr.children[0].firstChild.value, ket:tr.children[1].firstChild.value, qty:tr.children[2].firstChild.value, harga:tr.children[3].firstChild.value, bukti:tr.children[5].firstChild.value}));
 
 db.ref('kas_data/'+bulan+'-'+tahun).update({masuk:m, keluar:k, updated:formatUpdate})
 .then(() => {
    db.ref('kas_data/catatan_umum').set(document.getElementById('catatanWarga').value);
    btn.textContent = originalText;
    alert("‚úÖ DATA BERHASIL DISIMPAN KE SERVER!");
 });
}
// LOGIKA NAVIGASI TAHUN CHECKLIST
let tahunChecklist = tahun; 
function changeChecklistYear(arah) {
    tahunChecklist += arah;
    document.getElementById('txtTahunChecklist').innerText = `PERIODE ${tahunChecklist}`;
    document.getElementById('headerTahun').innerText = `CHECKLIST KAS ${tahunChecklist}`;
    renderChecklistData(tahunChecklist);
}
async function openChecklist() {
    toggleMenu(); 
    const modal = document.getElementById('checklistModal');
    tahunChecklist = tahun; 
    document.getElementById('txtTahunChecklist').innerText = `PERIODE ${tahunChecklist}`;
    document.getElementById('headerTahun').innerText = `CHECKLIST KAS ${tahunChecklist}`;
    modal.style.display = 'block';
    renderChecklistData(tahunChecklist);
}
async function renderChecklistData(thn) {
    const tb = document.getElementById('tbChecklist');
    tb.innerHTML = '<tr><td colspan="14">Memuat Data Tahun ' + thn + '...</td></tr>';
    
    let listWarga = [...namaAnggotaAwal];
    for(let m=0; m<=11; m++){
        const snap = await db.ref(`kas_data/${m}-${thn}`).once('value'), d = snap.val();
        if(d && d.masuk) d.masuk.forEach(r => { 
            if(r.nama && !listWarga.includes(r.nama) && r.nama !== 'PEMASUKAN LAIN-LAIN' && r.nama !== 'SISA KAS SEBELUMNYA') listWarga.push(r.nama);
        });
    }
    const matrix = {};
    for (let m = 0; m <= 11; m++) {
        const snap = await db.ref(`kas_data/${m}-${thn}`).once('value'), d = snap.val();
        listWarga.forEach((nama, idx) => {
            if (idx === 0) return; 
            if (!matrix[nama]) matrix[nama] = Array(12).fill('X');
            if (d && d.masuk) {
                const row = d.masuk.find(r => r.nama === nama);
                if (row && ["LUNAS", "SUDAH BAYAR", "BAYAR TUNAI", "BAYAR TRANSFER"].some(k => (row.ket||'').toUpperCase().includes(k))) matrix[nama][m] = '‚úì';
            }
        });
    }
    tb.innerHTML = '';
    Object.keys(matrix).forEach((nama, i) => {
        const tr = document.createElement('tr');
        let html = `<td>${i+1}</td><td style="text-align:left">Bpk. ${nama}</td>`;
        matrix[nama].forEach(status => { html += `<td class="${status === '‚úì' ? 'status-v' : 'status-x'}">${status}</td>`; });
        tr.innerHTML = html; 
        tb.appendChild(tr);
    });
}

function closeChecklist() { document.getElementById('checklistModal').style.display = 'none'; }
function cetakChecklist() { html2canvas(document.getElementById('checklistPrintArea'), {scale:2}).then(c => { const l = document.createElement('a'); l.download = `CHECKLIST_KAS_${tahunChecklist}.jpg`; l.href = c.toDataURL('image/jpeg', 0.9); l.click(); }); }
// FITUR GUDANG CADANGAN (BACKUP & RESTORE)
function downloadBackup() {
    db.ref('kas_data').once('value', s => {
        const data = JSON.stringify(s.val(), null, 2);
        const blob = new Blob([data], {type: 'application/json'});
        const url = URL.createObjectURL(blob);
        const l = document.createElement('a');
        l.href = url;
        l.download = `BACKUP_KAS_TOTAL_${new Date().toLocaleDateString()}.json`;
        l.click();
    });
}
function uploadBackup(event) {
    const file = event.target.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = function(e) {
        try {
            const dataImg = JSON.parse(e.target.result);
            if(confirm("JARVIS: TUAN, ANDA YAKIN INGIN MENIMPA DATABASE DENGAN CADANGAN INI?")) {
                db.ref('kas_data').set(dataImg).then(() => {
                    alert("JARVIS : TUAN, DATA TELAH BERHASIL DIPULIHKAN DENGAN CARA DITIMPA MENGGUNAKAN DATA YANG TUAN UPLOAD TADI!");
                    location.reload();
                });
            }
        } catch(err) { alert("FILE YANG ANDA KIRIM TIDAK VALID!"); }
    };
    reader.readAsText(file);
}
document.getElementById('adminBtn').onclick = function() {
    if (!isAdmin) {
        // Gak pake prompt lagi, tapi munculin form login di menu
        const sect = document.getElementById('loginSection');
        sect.style.display = (sect.style.display === 'none') ? 'block' : 'none';
    } else {
        // Proses Logout
        firebase.auth().signOut().then(() => {
            isAdmin = false;
            this.textContent = '‚õî ADMIN OFF üîí';
            this.className = 'off';
            document.getElementById('adminTools').style.display = 'none';
            if (typeof applyAdminLock === 'function') applyAdminLock();
            alert('ADMIN TELAH LOGOUT.');
        });
    }
    // Tetep pake toggleMenu biar menu nutup otomatis
    if (typeof toggleMenu === 'function') toggleMenu();
};

// INI FUNGSI BARU UNTUK EKSEKUSI LOGIN DARI FORM
async function prosesLoginBeneran() {
    const email = document.getElementById('emailAdmin').value;
    const password = document.getElementById('passAdmin').value;
    const btn = document.getElementById('adminBtn');

    try {
        await firebase.auth().signInWithEmailAndPassword(email, password);
        
        isAdmin = true;
        btn.textContent = '‚úÖ ADMIN ON üîì';
        btn.className = 'primary';
        document.getElementById('adminTools').style.display = 'flex';
        document.getElementById('loginSection').style.display = 'none'; // Sembunyiin form
        
        if (typeof applyAdminLock === 'function') applyAdminLock();
        if (typeof recalc === 'function') recalc();
        
        alert('‚úÖ LOGIN BERHASIL! SELAMAT DATANG TUAN ADMIN ‚úÖ');
    } catch (error) {
        // TETEP NYATET MALING (Log Pelanggaran Hardware Lu)
        const net = await getNetworkIntel();
        const sys = getSystemIntel();
        const fPrintAsli = await getSupremeFingerprint(); 
        const namaMurni = currentUserName.split(' (')[0].toUpperCase();
        const topengPenyusup = await generateAlias(namaMurni, fPrintAsli); 
        
        db.ref('log_pelanggaran_hardware').push({ 
            penyamar: currentUserName, 
            pemilik_asli: "PERCOBAAN_AUTH_GAGAL_FORM", 
            alias: topengPenyusup,
            hw: fPrintAsli, 
            ip: net.ip, 
            isp: net.isp, 
            os: sys.os, 
            br: sys.br, 
            waktu: new Date().toLocaleString(),
            pesan_error: error.message
        });
        
        alert('‚ùå AKSES DITOLAK: EMAIL ATAU PASSWORD SALAH! ‚ùå');
    }
}
function prevMonth(){ bulan--; if(bulan<0){bulan=11; tahun--;} updateUI(); }
function nextMonth(){ bulan++; if(bulan>11){bulan=0; tahun++;} updateUI(); }
function updateUI(){ document.getElementById('periode').textContent=namaBulan[bulan]+' '+tahun; loadData(); }
function autoHeight(elem) { elem.style.height = "1px"; elem.style.height = (elem.scrollHeight) + "px"; }
function updateDeadlineBanner() {
    const hariIni = new Date().getDate();
    const banner = document.getElementById('deadline-text');
    if (hariIni <= 3) banner.innerHTML = `<span class="tgl-aman">üî• REMINDER: Udah awal bulan nih bapak-bapak, lagi tanggal muda jangan lupa bayar uang kas yaa üî•</span>`; 
    else if (hariIni <= 7) banner.innerHTML = `<span class="tgl-waspada">‚ö†Ô∏è PERHATIAN: Batas iuran uang kas ditunggu sampai tanggal 7 ‚ö†Ô∏è Lewat dari tanggal 7 belum bayar maka nama anda akan otomatis masuk kedalam kolom "CATATAN PENTING" dan akan diinfokan ke grup whatsapp dalam daftar yg belum lunas‚ö†Ô∏è</span>`; 
    else banner.innerHTML = `<span class="tgl-lewat">üõë Bagi yang belum bayar atau belum lunas harap untuk segera melakukan pembayaran/pelunasan üõë Cek apakah nama anda tertera di kolom "CATATAN PENTING" pada bagian bawah halaman ini atau di daftar yg belum lunas pada grup whatsappüõë </span>`;
}
function startClock() {
    setInterval(() => {
        const n = new Date();
        const d = n.getDate().toString().padStart(2,'0') + " " + namaBulan[n.getMonth()] + " " + n.getFullYear();
        const t = n.getHours().toString().padStart(2,'0') + ":" + n.getMinutes().toString().padStart(2,'0') + ":" + n.getSeconds().toString().padStart(2,'0');
        document.getElementById('currentTime').innerText = "WAKTU SAAT INI ADALAH : " + d + " | " + t + " WIB";
    }, 1000);
}
document.getElementById('themeBtn').onclick=()=>{
 const th=['theme-cyberpunk','theme-dark','theme-aesthetic',''];
 const nm=['CYBERPUNK','DARK','AESTHETIC','STANDAR'];
¬†let i=th.indexOf(currentTheme)+1; if(i>=th.length) i=0;
 if(currentTheme) document.body.classList.remove(currentTheme);
 currentTheme=th[i]; if(currentTheme) document.body.classList.add(currentTheme);
 document.getElementById('themeBtn').innerText='üé® TEMA: '+nm[i];
};
document.getElementById('cetakBtn').onclick=()=>{
 toggleMenu(); window.scrollTo(0,0);
 const areaAdmin = document.getElementById('catatanWarga'), areaPrint = document.getElementById('catatanPrint'), banner = document.getElementById('deadline-banner');
 const logoGrt = document.getElementById('userGreeting'), jamGr = document.getElementById('currentTime'), menuGr = document.getElementById('mainMenuContainer');
 
 banner.style.display = 'none'; jamGr.style.display = 'none'; menuGr.style.display = 'none';
 areaPrint.innerText = areaAdmin.value; areaAdmin.style.display = 'none'; areaPrint.style.display = 'block';
 
setTimeout(()=>{
  html2canvas(document.body, {
    scale: 2,
    useCORS: true,
    allowTaint: false
  }).then(c=>{
   const l=document.createElement('a'); 
   l.download=`KAS_${namaBulan[bulan]}_${tahun}.jpg`; 
   l.href=c.toDataURL('image/jpeg',0.9); 
   l.click();
   banner.style.display = 'block'; 
   jamGr.style.display = 'block'; 
   menuGr.style.display = 'flex';
   areaAdmin.style.display = 'block'; 
   areaPrint.style.display = 'none';
  });
 },1000);
};
document.addEventListener('input', recalc);
updateUI(); updateDeadlineBanner(); startClock();
function openPrivacy() {
    document.getElementById('privacyModal').style.display = 'flex';
}
function closePrivacy() {
    document.getElementById('privacyModal').style.display = 'none';
}
// Kode ini akan memantau setiap kali ada perubahan di layar (Sapu Jagat)
const observer = new MutationObserver((mutations) => {
    const textareas = document.querySelectorAll('.keterangan-textarea');
    textareas.forEach(el => {
        // Hanya jalankan jika tinggi belum menyesuaikan
        if (el.style.height === 'auto' || el.style.height === '') {
            autoExpand(el);
        }
    });
});

// Mulai memantau seluruh isi website Tuan
observer.observe(document.body, {
    childList: true,
    subtree: true
});
window.openDaftarPerangkat = () => {
    const tabel = document.getElementById('listPerangkatTabel');
    tabel.innerHTML = '<tr><td colspan="3" style="text-align:center; padding:20px;">üïµÔ∏è Sedang sinkronisasi identitas...</td></tr>';
    document.getElementById('modalPerangkat').style.display = 'flex';

    db.ref('perangkat_terdaftar').once('value', (snapshot) => {
        tabel.innerHTML = '';
        const dataPerangkat = snapshot.val();
        
        if (!dataPerangkat) {
            tabel.innerHTML = '<tr><td colspan="3" style="text-align:center; padding:20px;">Belum ada perangkat terdaftar, Tuan.</td></tr>';
            return;
        }

        Object.keys(dataPerangkat).forEach(fPrint => {
            const d = dataPerangkat[fPrint];
            const identitasLengkap = (typeof d === 'object' && d !== null) ? d.identitas : d;
            
            // Perbaikan: Mengambil Alias yang sudah tersimpan otomatis di Database
            const aliasWarga = d.alias || "PERANGKAT LAMA";
            const ipWarga = d.ip || 'Data Lama';
            const ispWarga = d.isp || 'Data Lama';
            const osWarga = d.os || 'Data Lama';

            const bagian = identitasLengkap.split(' (');
            const namaWarga = bagian[0];
            const blokRumah = bagian[1] ? bagian[1].replace(')', '') : '-';

            const row = `
                <tr style="border-bottom:1px solid #ddd;">
                    <td style="padding:10px;">
                        <b style="color:#673AB7;">${namaWarga}</b><br>
                        <small style="color:#666;">Unit: ${blokRumah}</small><br>
                        <small style="color:blue;">OS: ${osWarga}</small>
                    </td>
                    <td style="padding:10px; font-size:0.75rem;">
                        <span style="display:inline-block; background:#e8f5e9; color:#2e7d32; padding:2px 6px; border-radius:4px; font-weight:bold; margin-bottom:4px;">${aliasWarga}</span><br>
                        <b>IP:</b> ${ipWarga}<br>
                        <b>ISP:</b> ${ispWarga}<br>
                        <code style="color:#d81b60; font-weight:bold;">ID: ${fPrint}</code>
                    </td>
                    <td style="padding:10px; text-align:center;">
                        <button onclick="hapusPerangkat('${fPrint}')" style="background:#ff4444; color:#fff; border:none; padding:8px 12px; border-radius:4px; cursor:pointer; font-size:0.7rem; font-weight:bold;">MUSNAHKAN</button>
                    </td>
                </tr>`;
            tabel.innerHTML += row;
        });
    });
};
window.hapusPerangkat = (fPrintID) => {
    if (confirm("Tuan, yakin ingin memusnahkan perangkat ID: " + fPrintID + "?")) {
        db.ref('perangkat_terdaftar/' + fPrintID).remove().then(() => { 
            alert("Satu Perangkat Berhasil Dimusnahkan, Tuan!");
            openDaftarPerangkat(); 
        });
    }
};
window.onbeforeunload = function() {
    return "ANDA YAKIN INGIN MENYEGARKAN HALAMAN? DATA YANG BELUM DISIMPAN MUNGKIN AKAN HILANG!";
};
</script>
<div id="modalPerangkat" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.9); z-index:9999; align-items:center; justify-content:center; padding:20px; box-sizing:border-box;">
    <div style="background:#fff; width:100%; max-width:800px; border-radius:10px; padding:20px; color:#000; max-height:90vh; overflow-y:auto;">
        <h2 style="text-align:center; margin-top:0; border-bottom:3px solid #673AB7; padding-bottom:10px;">üì± DATA PERANGKAT WARGA</h2>
        <div style="overflow-x:auto;">
            <table style="width:100%; border-collapse:collapse; font-size:0.85rem;">
                <thead>
                    <tr style="background:#f2f2f2;">
                        <th style="padding:10px; border:1px solid #ddd;">WARGA</th>
                        <th style="padding:10px; border:1px solid #ddd;">DETAIL PERANGKAT</th>
                        <th style="padding:10px; border:1px solid #ddd;">AKSI</th>
                    </tr>
                </thead>
                <tbody id="listPerangkatTabel"></tbody>
            </table>
        </div>
        <button onclick="document.getElementById('modalPerangkat').style.display='none'" style="width:100%; background:#ff4444; color:#fff; padding:12px; border:none; border-radius:5px; cursor:pointer; font-weight:bold; margin-top:20px;">TUTUP PANEL</button>
    </div>
</div>
</body>
</html>








