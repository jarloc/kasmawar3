<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=1024">
<title>LAPORAN KAS GANG MAWAR 3 - V10.1 SUPREME</title>
<style>
/* ... (Style tetap sama dengan v10.0, hanya penambahan style tombol reset) ... */
:root{ --bg:#f5f5f5;--card:#ffffff;--text:#000000;--border:#cccccc;--accent:#4caf50;--danger:#d9534f;--success:#28a745;--yellow:#fff200;--font:Arial,sans-serif; }
.logo-mawar-container { position: fixed; top: 10px; left: 15px; z-index: 1001; display: flex; flex-direction: column; align-items: flex-start; }
.logo-img { width: 100px; height: auto; filter: drop-shadow(0 0 5px rgba(0,0,0,0.3)); transition: all 0.3s; }
.logo-welcome { width: 450px; height: auto; margin-bottom: 20px; filter: drop-shadow(0 0 15px #00ffcc); }
#userGreeting { font-size: 0.75rem; font-weight: bold; margin-top: 5px; color: var(--text); text-shadow: 1px 1px 2px rgba(0,0,0,0.1); display: none; background: rgba(255,255,255,0.6); padding: 2px 8px; border-radius: 4px; border: 1px solid var(--border); }
input:disabled { -webkit-text-fill-color: currentcolor !important; color: inherit !important; opacity: 1 !important; background-color: inherit; border-color: transparent; }
button { padding: 20px 32px; font-size: 1.2rem; border-radius: 12px; font-weight: 600; cursor: pointer; text-transform: uppercase; border: 0; transition: all 0.2s; }
.menu-items button { width: 100%; margin-bottom: 12px; }
#welcomeScreen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; color: #fff; z-index: 99999; display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center; }
#welcomeScreen h1 { font-size: 2.2rem; color: #00ffcc; text-shadow: 0 0 15px #00ffcc; margin: 0 20px 10px; font-family: Arial, sans-serif; }
#welcomeScreen p { font-size: 1rem; color: #aaa; text-transform: none; margin-bottom: 40px; font-family: Arial, sans-serif; padding: 0 20px; }
#enterBtn { padding: 15px 80px; background: #00ffcc; color: #000; font-weight: bold; border-radius: 8px; border: none; cursor: pointer; text-transform: uppercase; font-size: 1.2rem; box-shadow: 0 0 20px rgba(0,255,204,0.4); }
#modalPengunjung { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.9); z-index:3000; padding:20px; box-sizing:border-box; }
.pengunjung-content { background:#fff; color:#000; padding:20px; border-radius:10px; max-width:600px; margin:0 auto; max-height:80vh; overflow-y:auto; }
body{font-family:var(--font);background:var(--bg);margin:0;padding:20px;text-transform:uppercase;color:var(--text);-webkit-font-smoothing: antialiased;}
header{text-align:center;font-size:2rem;margin-bottom:5px}
.update-info {text-align:center; font-size:0.85rem; color:#666; margin-bottom:10px; font-weight:normal; text-transform:none;}
#deadline-banner { background: #333; color: #fff; padding: 10px; margin: 10px 16px; border-radius: 8px; font-weight: bold; overflow: hidden; white-space: nowrap; }
#deadline-banner marquee { font-size: 1.1rem; }
.menu-container {position:fixed; top:12px; right:12px; z-index:1000; display:flex; flex-direction:column; align-items:flex-end; gap:8px}
.menu-items {display:none; flex-direction:column; gap:8px; background:rgba(0,0,0,0.9); padding:12px; border-radius:12px; box-shadow:0 4px 20px rgba(0,0,0,0.4); width: 250px;}
.menu-items.show {display:flex}
button.main-menu {background:#333; color:#fff; border:2px solid #fff; padding: 15px 25px;}
button.primary{background:var(--accent);color:#fff}
button.off{background:#999;color:#fff}
button.warning{background:#f0ad4e;color:#fff;border:1px solid #fff}
.block{margin:16px;padding:14px;background:var(--card);border-radius:14px;box-shadow:0 2px 8px rgba(0,0,0,.08);position:relative;transition:all 0.3s}
.block h2{font-size:1.3rem;margin-bottom:10px;text-align:center}
.grand-total-table{width:100%;border-collapse:collapse;margin-top:10px}
.grand-total-table th, .grand-total-table td{border:1px solid var(--border);padding:8px;text-align:center;font-weight:700}
#totalMasuk { background:var(--success); color:#ffffff; }
#totalKeluar { background:var(--danger); color:#ffffff; }
.saldo-akhir { background:var(--yellow); color:#000000; }
.note-box {border:2px dashed var(--border); padding:20px; background:rgba(0,0,0,0.03); border-radius:12px; margin-top:20px;}
#catatanWarga { width:100%; background:transparent; border:0; color:var(--text); font-family:inherit; font-size:1.1rem; resize:none; text-transform:none; min-height:50px; overflow:hidden; line-height:1.5; white-space: pre-wrap; word-wrap: break-word; display: block; }
table{width:100%;border-collapse:collapse}
th,td{border:1px solid var(--border);padding:6px;text-align:left}
th{text-align:center; background:#eee; color:#000}
input{padding:4px;border-radius:6px;border:1px solid #ccc;width:100%;box-sizing:border-box;text-transform:none;font-family:inherit; color:inherit; background:transparent;}

/* THEME CYBERPUNK DLL TETAP DISINI */
.theme-cyberpunk{--bg:#050505;--card:#0f0f0f;--text:#00ffcc;--border:#ff00ff;--accent:#ffff00;--yellow:#ffff00;}
.theme-dark{--bg:#1e1e1e;--text:#eee;--card:#2a2a2a;--border:#444}
.theme-blue{--bg:#eef4ff;--text:#102040;--card:#fff}

#checklistModal, #usulanModal { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.9); z-index:2000; overflow-y:auto; padding:20px; box-sizing:border-box; }
.checklist-content, .usulan-content { background:#fff; color:#000; padding:20px; border-radius:10px; max-width:980px; margin:0 auto; }
.admin-action { display: none; width: 40px; text-align: center; }
#adminTools { display:none; flex-direction:column; gap:8px; border-top:1px solid #555; padding-top:10px; }
.btn-reset-hw { background: #d9534f; color: white; border: none; padding: 4px 8px; border-radius: 4px; font-size: 0.7rem; cursor: pointer; }
</style>
</head>
<body>

<div id="welcomeScreen">
    <img src="logo.png" alt="LOGO MAWAR 3" class="logo-welcome">
    <h1>SELAMAT DATANG DI WEBSITE KAS GANG MAWAR 3</h1>
    <p>Built and developed by Fajar Ilmanosa Viar V10.1 Supreme Security Copyright ¬© 2026 Gang Mawar 3 . All Rights Reserved.</p>
    <button id="enterBtn" onclick="masukWeb()">ENTER</button>
</div>

<div class="logo-mawar-container">
    <img src="logo.png" alt="LOGO" class="logo-img">
    <div id="userGreeting">SELAMAT DATANG, BPK. ...</div>
</div>

<div id="modalPengunjung">
    <div class="pengunjung-content">
        <h2 style="text-align:center; border-bottom:2px solid #000; padding-bottom:10px;">DAFTAR PENGUNJUNG</h2>
        <div id="listPengunjung" style="margin:20px 0; font-size:0.9rem;"></div>
        <div id="secLogAdmin" style="display:none; border-top:2px dashed #000; padding-top:15px; margin-top:15px;">
            <h3 style="text-align:center; color:red;">üö® LOG KEAMANAN SISTEM üö®</h3>
            <div id="listLogAdmin" style="font-size:0.85rem; color:#d9534f;"></div>
            <button onclick="hapusRiwayatLog()" style="width:100%; background:orange; color:#000; font-weight:bold; margin-top:10px;">üóëÔ∏è BERSIHKAN LOG</button>
        </div>
        <button onclick="document.getElementById('modalPengunjung').style.display='none'" style="width:100%; background:red; color:#fff; margin-top:10px;">TUTUP</button>
    </div>
</div>

<header>
  LAPORAN KAS GANG MAWAR 3
  <div style="margin-top:10px; text-align:center">
    <button onclick="prevMonth()">‚óÄ</button>
    <span id="periode" style="min-width:180px; display:inline-block">...</span>
    <button onclick="nextMonth()">‚ñ∂</button>
  </div>
  <div class="update-info" id="lastUpdate">TERAKHIR DI UPDATE PADA: -</div>
</header>

<div id="deadline-banner">
    <marquee id="deadline-text" scrollamount="5">Mengecek tanggal...</marquee>
</div>

<div class="menu-container">
    <button class="main-menu" onclick="toggleMenu()">‚ò∞ MENU</button>
    <div class="menu-items" id="menuItems">
        <button id="adminBtn" class="off">‚õî ADMIN OFF üîí</button>
        <div id="adminTools">
            <button onclick="tambahBaris('WARGA')" style="background:#28a745; color:#fff;">üë§ TAMBAH WARGA</button>
            <button onclick="tambahBaris('LAIN')" style="background:#17a2b8; color:#fff;">üì• TAMBAH PEMASUKAN</button>
            <button onclick="tambahBaris('KELUAR')" style="background:#d9534f; color:#fff;">üì§ TAMBAH PENGELUARAN</button>
            <button id="saveBtnManual" onclick="saveData()" style="background:#007bff; color:#fff;">üíæ SIMPAN DATA</button>
            <button id="listVisitorBtn" class="warning" onclick="openPengunjung()">üëÄ DAFTAR PENGUNJUNG</button>
        </div>
        <button onclick="openUsulan()" style="background:#ff9800; color:#fff;">üìù FORM USULAN WARGA</button>
        <button onclick="openChecklist()" class="primary">‚úÖ CHECKLIST KAS</button>
        <button id="themeBtn" class="primary">üé® GANTI TEMA</button>
        <button id="cetakBtn" class="primary">üñ®Ô∏è CETAK LAPORAN</button>
    </div>
</div>

<div class="block">
<h2>PEMASUKAN</h2>
<table>
<tr><th style="width:40px">Tgl</th><th style="width:25%">Nama</th><th style="width:50%">Keterangan</th><th style="width:15%">Masuk</th><th style="width:15%">Saldo</th><th class="admin-action">HPS</th></tr>
<tbody id="tbMasuk"></tbody>
</table>
</div>

<div class="block">
<h2>PENGELUARAN</h2>
<table>
<tr><th style="width:30px">Tgl</th><th style="width:40%">Keterangan</th><th style="width:8%">Qty</th><th style="width:25%">Harga</th><th style="width:25%">Total</th><th class="admin-action">HPS</th></tr>
<tbody id="tbKeluar"></tbody>
</table>
</div>

<div class="block">
<h2>GRAND TOTAL</h2>
<table class="grand-total-table">
<tr><th>TOTAL UANG MASUK</th><th>TOTAL UANG KELUAR</th><th>SALDO AKHIR</th></tr>
<tr><td id="totalMasuk">0</td><td id="totalKeluar">0</td><td id="saldoAkhir" class="saldo-akhir">0</td></tr>
</table>
</div>

<div class="block note-box">
  <h2 style="text-align:left; font-size:1.1rem; border-bottom:1px solid var(--border); padding-bottom:10px">üìå CATATAN PENTING</h2>
  <textarea id="catatanWarga" class="editable" placeholder="Klik Admin ON untuk mengisi catatan..." oninput="autoHeight(this)"></textarea>
</div>

<div id="checklistModal"><div class="checklist-content"><button onclick="closeChecklist()" style="background:red; color:white;">TUTUP</button><div id="checklistPrintArea"><tbody id="tbChecklist"></tbody></div></div></div>
<div id="usulanModal"><div class="usulan-content"><button onclick="document.getElementById('usulanModal').style.display='none'">TUTUP</button><tbody id="tbUsulan"></tbody></div></div>

<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

<script>
// CONFIG FIREBASE TUAN
const firebaseConfig = { apiKey: "AIzaSyAn5Iw4cI8bRSGuyRr3TNNVWzQA-duRHvk", authDomain: "kasmawar3-59c18.firebaseapp.com", databaseURL: "https://kasmawar3-59c18-default-rtdb.asia-southeast1.firebasedatabase.app", projectId: "kasmawar3-59c18", storageBucket: "kasmawar3-59c18.firebasestorage.app", messagingSenderId: "643313437210", appId: "1:643313437210:web:7377bbd6e4cd9aa33b5fa3" };
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

const daftarKunci = { "D3/2": "RIZAL", "D3/3": "ROMI", "D3/4": "TRI", "D3/5": "ANIS", "D3/6": "FAJAR DJAKA", "D3/7": "FAJAR SHANUM", "D3/10": "AGUS", "D3/11": "LUKMAN", "D2/16": "IRAWAN", "D2/17": "RIAN", "D2/18": "MULYADIE", "D2/19": "HELDI", "D2/20": "HILMAN", "D2/21": "HILMAN", "D2/22": "NANO", "D2/23": "TEGUH" };

let bulan = new Date().getMonth(), tahun = new Date().getFullYear(), isAdmin=false, currentUserName='';
const namaBulan=['JANUARI','FEBRUARI','MARET','APRIL','MEI','JUNI','JULI','AGUSTUS','SEPTEMBER','OKTOBER','NOVEMBER','DESEMBER'];

// --- FINGERPRINT ENGINE ---
async function generateFingerprint() {
    const canvas = document.createElement('canvas'); const ctx = canvas.getContext('2d');
    ctx.textBaseline = "top"; ctx.font = "14px Arial"; ctx.fillText("Mawar3-V10.1", 2, 2);
    const b64 = canvas.toDataURL(); let hash = 0;
    for (let i = 0; i < b64.length; i++) { hash = ((hash << 5) - hash) + b64.charCodeAt(i); hash |= 0; }
    return "HW-" + Math.abs(hash).toString(16).toUpperCase() + "-" + (screen.width);
}

async function masukWeb() {
    let kunci = prompt("NOMOR BLOK RUMAH:"); if (!kunci) return;
    let bersih = kunci.toUpperCase().replace(/[\s\.\-]/g, '');
    if (daftarKunci[bersih]) {
        const fPrint = await generateFingerprint();
        const namaTarget = daftarKunci[bersih] + " (" + bersih + ")";
        const snap = await db.ref('perangkat_terdaftar/' + fPrint).once('value');
        const pemilikAsli = snap.val();

        if (pemilikAsli && pemilikAsli !== namaTarget) {
            alert("üõë AKSES DITOLAK!\nHP ini terdaftar milik " + pemilikAsli + ".\n\nJika ini salah, lapor ke Bpk. Fajar untuk Reset.");
            db.ref('log_pelanggaran_hardware').push({ penyamar: namaTarget, pemilik_asli: pemilikAsli, hw: fPrint, waktu: new Date().toLocaleString() });
            return;
        }
        if (!pemilikAsli) db.ref('perangkat_terdaftar/' + fPrint).set(namaTarget);
        currentUserName = namaTarget;
        db.ref('pengunjung_situs').push({ nama: currentUserName, hw: fPrint, waktu: new Date().toLocaleString() });
        document.getElementById('userGreeting').innerText = "SELAMAT DATANG, BPK. " + daftarKunci[bersih];
        document.getElementById('userGreeting').style.display = 'block';
        document.getElementById('welcomeScreen').remove();
    } else { alert("BLOK TIDAK ADA!"); }
}

// --- FUNGSI ADMIN: RESET HP ---
function resetHardware(hwID, namaWarga) {
    if (isAdmin && confirm("YAKIN RESET HP MILIK " + namaWarga + "?\nPerangkat ini akan bisa digunakan login akun lain.")) {
        db.ref('perangkat_terdaftar/' + hwID).remove().then(() => { alert("BERHASIL DIRESET!"); openPengunjung(); });
    }
}

function openPengunjung() {
    const modal = document.getElementById('modalPengunjung'), list = document.getElementById('listPengunjung'), secLog = document.getElementById('secLogAdmin'), listLog = document.getElementById('listLogAdmin');
    secLog.style.display = isAdmin ? 'block' : 'none'; modal.style.display = 'block'; list.innerHTML = "Memuat...";
    
    db.ref('pengunjung_situs').limitToLast(20).once('value', s => {
        const d = s.val(); if(d) {
            let h = "<table style='width:100%; font-size:0.8rem;'><tr><th>NAMA</th><th>AKSI</th></tr>";
            Object.values(d).reverse().forEach(v => {
                h += `<tr><td>${v.nama}<br><small>${v.waktu}</small></td>
                <td>${isAdmin ? `<button class="btn-reset-hw" onclick="resetHardware('${v.hw}','${v.nama}')">RESET HP</button>` : '-'}</td></tr>`;
            });
            list.innerHTML = h + "</table>";
        }
    });

    if(isAdmin) {
        db.ref('log_pelanggaran_hardware').limitToLast(10).once('value', s => {
            const d = s.val(); let h = "";
            if(d) Object.values(d).reverse().forEach(v => { h += `<p>‚ö†Ô∏è ${v.penyamar} mencoba di HP ${v.pemilik_asli} (${v.waktu})</p>`; });
            listLog.innerHTML = h || "Bersih.";
        });
    }
}

function hapusRiwayatLog() { if(isAdmin && confirm("HAPUS LOG?")) db.ref('log_pelanggaran_hardware').remove(); }
function toggleMenu() { document.getElementById('menuItems').classList.toggle('show'); }

// (Fungsi Kas Dasar & Usulan tetap sama dengan v10.0, hamba jaga agar tidak rusak)
function updateUI(){ document.getElementById('periode').textContent=namaBulan[bulan]+' '+tahun; }
document.getElementById('adminBtn').onclick = function() {
    let p = prompt('PASSWORD ADMIN:');
    if(p === 'SANUMION') { isAdmin=true; this.textContent='‚úÖ ADMIN ON'; document.getElementById('adminTools').style.display='flex'; }
    else { alert('SALAH!'); }
};

updateUI();
</script>
</body>
</html>
