<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>LAPORAN KAS GANG MAWAR 3</title>
<style>
:root{
 --bg:#f5f5f5;--card:#ffffff;--text:#000000;--border:#cccccc;--accent:#4caf50;--danger:#d9534f;--success:#28a745;--yellow:#fff200;--font:Arial,sans-serif;
}

/* RESET TOTAL */
* { box-sizing: border-box; }
body { 
    font-family: var(--font); background: var(--bg); margin: 0; padding: 0;
    text-transform: uppercase; color: var(--text); overflow-x: hidden;
}

/* --- WELCOME SCREEN --- */
#welcomeScreen {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
    background: #000; color: #fff; z-index: 9999; 
    display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center;
}
#welcomeScreen h1 { font-size: 1.8rem; margin: 0 20px 10px; color: #00ffcc; }
#welcomeInput { 
    padding: 12px; width: 280px; border-radius: 8px; border: 2px solid #00ffcc; 
    background: transparent; color: #fff; text-align: center; font-size: 16px; outline: none; margin-bottom: 20px;
}
#enterBtn { padding: 12px 50px; background: #00ffcc; color: #000; font-weight: bold; border-radius: 8px; border: none; cursor: pointer; }

/* --- WRAPPER UNTUK MODE DESKTOP --- */
/* Ini yang bikin tampilan rapi di HP tapi tetep lebar Desktop */
#mainWrapper {
    width: 1024px; /* Lebar asli web lu */
    margin: 0 auto;
    background: var(--bg);
    padding: 20px;
    transform-origin: top left; /* Titik tumpu pengecilan */
    display: none; /* Sembunyi dulu sebelum Login */
}

header { text-align: center; font-size: 2.2rem; margin-bottom: 20px; }
.update-info { text-align: center; font-size: 0.9rem; color: #666; margin-bottom: 15px; text-transform: none; }

.menu-container { position: fixed; top: 20px; right: 20px; z-index: 1000; display: flex; flex-direction: column; align-items: flex-end; gap: 8px; }
.menu-items { display: none; flex-direction: column; gap: 8px; background: rgba(0,0,0,0.9); padding: 15px; border-radius: 8px; }
.menu-items.show { display: flex; }

button { padding: 12px 18px; border: 0; border-radius: 8px; font-weight: 600; cursor: pointer; text-transform: uppercase; }
button.main-menu { background: #333; color: #fff; border: 2px solid #fff; }
button.primary { background: var(--accent); color: #fff; }
button.warning { background: #f0ad4e; color: #fff; }

.block { margin-bottom: 20px; padding: 20px; background: var(--card); border-radius: 14px; box-shadow: 0 2px 10px rgba(0,0,0,.1); }
.block h2 { font-size: 1.5rem; text-align: center; margin-bottom: 15px; }

table { width: 100%; border-collapse: collapse; table-layout: fixed; }
th, td { border: 1px solid var(--border); padding: 10px; text-align: left; font-size: 1.1rem; }
th { background: #eee; text-align: center; }
input { padding: 8px; border-radius: 6px; border: 1px solid #ccc; width: 100%; font-size: 1.1rem; }

.grand-total-table td { padding: 15px; font-size: 1.3rem; text-align: center; font-weight: bold; }
#totalMasuk { background: var(--success); color: #fff; }
#totalKeluar { background: var(--danger); color: #fff; }
.saldo-akhir { background: var(--yellow); color: #000; }

#catatanWarga { width: 100%; background: transparent; border: 0; font-family: inherit; font-size: 1.2rem; min-height: 100px; text-transform: none; }

/* MODAL */
#visitorModal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 2000; padding: 20px; }
.modal-inner { background: #fff; color: #000; padding: 20px; border-radius: 12px; width: 900px; margin: 0 auto; }
</style>
</head>
<body>

<div id="welcomeScreen">
    <h1>KAS GANG MAWAR 3</h1>
    <p>Silakan masukkan nama anda untuk melanjutkan</p>
    <input type="text" id="welcomeInput" placeholder="NAMA ANDA">
    <button id="enterBtn" onclick="masukWeb()">MASUK</button>
</div>

<div id="mainWrapper">
    <header>
      LAPORAN KAS GANG MAWAR 3
      <div style="margin-top:10px;">
        <button onclick="prevMonth()">â—€</button>
        <span id="periode" style="min-width:250px; display:inline-block">...</span>
        <button onclick="nextMonth()">â–¶</button>
      </div>
      <div class="update-info" id="lastUpdate">TERAKHIR DI UPDATE: -</div>
    </header>

    <div class="menu-container">
        <button class="main-menu" onclick="toggleMenu()">â˜° MENU</button>
        <div class="menu-items" id="menuItems">
            <button id="adminBtn" class="off">ADMIN OFF</button>
            <button id="visitorBtn" class="warning" style="display:none" onclick="openVisitors()">DAFTAR PENGUNJUNG</button>
            <button id="cetakBtn" class="primary">CETAK GAMBAR</button>
        </div>
    </div>

    <div class="block">
        <h2>PEMASUKAN</h2>
        <table>
            <thead><tr><th style="width:100px">Tgl</th><th style="width:200px">Nama</th><th>Keterangan</th><th style="width:150px">Masuk</th><th style="width:150px">Saldo</th></tr></thead>
            <tbody id="tbMasuk"></tbody>
        </table>
    </div>

    <div class="block">
        <h2>PENGELUARAN</h2>
        <table>
            <thead><tr><th style="width:100px">Tgl</th><th>Keterangan</th><th style="width:80px">Qty</th><th style="width:150px">Harga</th><th style="width:150px">Total</th></tr></thead>
            <tbody id="tbKeluar"></tbody>
        </table>
    </div>

    <div class="block">
        <h2>GRAND TOTAL</h2>
        <table class="grand-total-table">
            <tr><th>TOTAL MASUK</th><th>TOTAL KELUAR</th><th>SALDO AKHIR</th></tr>
            <tr><td id="totalMasuk">0</td><td id="totalKeluar">0</td><td id="saldoAkhir" class="saldo-akhir">0</td></tr>
        </table>
    </div>

    <div class="block">
      <h2 style="text-align:left;">ðŸ“Œ CATATAN</h2>
      <textarea id="catatanWarga" class="editable" disabled></textarea>
    </div>
</div>

<div id="visitorModal">
    <div class="modal-inner">
        <button onclick="document.getElementById('visitorModal').style.display='none'">TUTUP</button>
        <h2>DAFTAR PENGUNJUNG</h2>
        <table style="width:100%"><tbody id="tbVisitors"></tbody></table>
    </div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

<script>
// Firebase Config
const firebaseConfig = {
    apiKey: "AIzaSyAn5Iw4cI8bRSGuyRr3TNNVWzQA-duRHvk",
    authDomain: "kasmawar3-59c18.firebaseapp.com",
    databaseURL: "https://kasmawar3-59c18-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "kasmawar3-59c18",
    storageBucket: "kasmawar3-59c18.firebasestorage.app",
    messagingSenderId: "643313437210",
    appId: "1:643313437210:web:7377bbd6e4cd9aa33b5fa3"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

const skrg = new Date();
let bulan = skrg.getMonth(), tahun = skrg.getFullYear(), isAdmin = false;
const namaBulan=['JANUARI','FEBRUARI','MARET','APRIL','MEI','JUNI','JULI','AGUSTUS','SEPTEMBER','OKTOBER','NOVEMBER','DESEMBER'];
const namaAnggota=['SISA KAS SEBELUMNYA','RIZAL','ROMI','TRI','ANIS','FAJAR DJAKA','FAJAR SHANUM','AGUS','LUKMAN','IRAWAN','RIAN','MULYADIE','HELDI','HILMAN','NANO','TEGUH'];

// --- FUNGSI ANTI BUG TAMPILAN ---
function applyResponsiveScale() {
    const wrapper = document.getElementById('mainWrapper');
    const screenWidth = window.innerWidth;
    const targetWidth = 1024;
    
    if (screenWidth < targetWidth) {
        const scale = screenWidth / targetWidth;
        wrapper.style.transform = `scale(${scale})`;
        // Menghitung sisa tinggi agar tidak ada ruang kosong di bawah
        document.body.style.height = (wrapper.offsetHeight * scale) + "px";
    } else {
        wrapper.style.transform = `none`;
        document.body.style.height = "auto";
    }
}

function masukWeb() {
    const nama = document.getElementById('welcomeInput').value.trim();
    if (!nama) return alert("Isi nama!");
    
    // Log Visitor
    const tgl = new Date();
    db.ref('pengunjung_situs').push({ 
        nama: nama, 
        waktu: tgl.toLocaleString('id-ID'), 
        timestamp: firebase.database.ServerValue.TIMESTAMP 
    });

    document.getElementById('welcomeScreen').style.display = 'none';
    const wrapper = document.getElementById('mainWrapper');
    wrapper.style.display = 'block';
    
    // Jalankan Scale
    applyResponsiveScale();
    window.scrollTo(0,0);
}

// Jalankan ulang scale jika layar HP diputar (rotate)
window.addEventListener('resize', () => {
    if (document.getElementById('mainWrapper').style.display === 'block') {
        applyResponsiveScale();
    }
});

function toggleMenu() { document.getElementById('menuItems').classList.toggle('show'); }

function buildTables(){
 document.getElementById('tbMasuk').innerHTML=''; document.getElementById('tbKeluar').innerHTML='';
 namaAnggota.forEach(n=>{
  const tr=document.createElement('tr');
  tr.innerHTML=`<td><input class='editable' type='date'></td><td><input class='editable' value='${n}'></td><td><input class='editable'></td><td><input class='editable' value='0'></td><td>0</td>`;
  document.getElementById('tbMasuk').appendChild(tr);
 });
 for(let i=0;i<10;i++){
  const tr=document.createElement('tr');
  tr.innerHTML=`<td><input class='editable' type='date'></td><td><input class='editable'></td><td><input class='editable' value='0'></td><td><input class='editable' value='0'></td><td>0</td>`;
  document.getElementById('tbKeluar').appendChild(tr);
 }
}

function recalc(){
 let tM=0, tK=0;
 document.querySelectorAll('#tbMasuk tr').forEach(tr=>{
  let u=parseInt(tr.children[3].firstChild.value.replace(/[^0-9]/g,''))||0; tM+=u;
  tr.children[3].firstChild.value=u.toLocaleString('id-ID');
 });
 document.querySelectorAll('#tbKeluar tr').forEach(tr=>{
  let q=parseInt(tr.children[2].firstChild.value.replace(/[^0-9]/g,''))||0, h=parseInt(tr.children[3].firstChild.value.replace(/[^0-9]/g,''))||0;
  let t=q*h; tK+=t;
  tr.children[4].textContent=t.toLocaleString('id-ID');
 });
 document.getElementById('totalMasuk').textContent=tM.toLocaleString('id-ID');
 document.getElementById('totalKeluar').textContent=tK.toLocaleString('id-ID');
 document.getElementById('saldoAkhir').textContent=(tM-tK).toLocaleString('id-ID');
}

function loadData(){
 buildTables();
 db.ref('kas_data/'+bulan+'-'+tahun).once('value', s=>{
  const d=s.val();
  if(d){
   if(d.masuk) d.masuk.forEach((r,i)=>{ const tr=document.querySelectorAll('#tbMasuk tr')[i]; if(tr){ tr.children[0].firstChild.value=r.tanggal||''; tr.children[1].firstChild.value=r.nama||namaAnggota[i]; tr.children[2].firstChild.value=r.ket||''; tr.children[3].firstChild.value=r.uang||'0'; } });
   if(d.keluar) d.keluar.forEach((r,i)=>{ const tr=document.querySelectorAll('#tbKeluar tr')[i]; if(tr){ tr.children[0].firstChild.value=r.tanggal||''; tr.children[1].firstChild.value=r.ket||''; tr.children[2].firstChild.value=r.qty||'0'; tr.children[3].firstChild.value=r.harga||'0'; } });
   if(d.updated) document.getElementById('lastUpdate').textContent = "TERAKHIR DI UPDATE: " + d.updated;
  }
  recalc(); applyAdminLock();
 });
}

function applyAdminLock(){ document.querySelectorAll('.editable').forEach(i=>i.disabled=!isAdmin); }

document.getElementById('adminBtn').onclick = function() {
 if(!isAdmin){
  let p=prompt('PASS');
  if(p && p.toUpperCase()==='SANUMION'){
   isAdmin=true; this.textContent='ADMIN ON';
   document.getElementById('visitorBtn').style.display='block';
   applyAdminLock();
  }
 } else {
  isAdmin=false; this.textContent='ADMIN OFF';
  document.getElementById('visitorBtn').style.display='none';
  applyAdminLock();
 }
 toggleMenu();
};

function prevMonth(){ bulan--; if(bulan<0){bulan=11; tahun--;} updateUI(); }
function nextMonth(){ bulan++; if(bulan>11){bulan=0; tahun++;} updateUI(); }
function updateUI(){ document.getElementById('periode').textContent=namaBulan[bulan]+' '+tahun; loadData(); }

document.addEventListener('input', recalc);
updateUI();
</script>
</body>
</html>
