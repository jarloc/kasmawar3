<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=1024">
<title>LAPORAN KAS GANG MAWAR 3</title>
<style>
:root{
 --bg:#f5f5f5;--card:#ffffff;--text:#000000;--border:#cccccc;--accent:#4caf50;--danger:#d9534f;--success:#28a745;--yellow:#fff200;--font:Arial,sans-serif;
}
.logo-mawar-container { position: fixed; top: 10px; left: 15px; z-index: 1001; }
.logo-img { width: 100px; height: auto; filter: drop-shadow(0 0 5px rgba(0,0,0,0.3)); }
.logo-welcome { width: 450px; height: auto; margin-bottom: 20px; filter: drop-shadow(0 0 15px #00ffcc); }
input:disabled { -webkit-text-fill-color: currentcolor !important; color: inherit !important; opacity: 1 !important; }
button { padding: 20px 32px; font-size: 1.2rem; border-radius: 12px; font-weight: 600; cursor: pointer; text-transform: uppercase; border: 0; }
.menu-items button { width: 100%; margin-bottom: 12px; }
#welcomeScreen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; color: #fff; z-index: 99999; display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center; }
#welcomeScreen h1 { font-size: 2.2rem; color: #00ffcc; text-shadow: 0 0 15px #00ffcc; margin: 0 20px 10px; }
#enterBtn { padding: 15px 80px; background: #00ffcc; color: #000; font-weight: bold; border-radius: 8px; font-size: 1.2rem; box-shadow: 0 0 20px rgba(0,255,204,0.4); }
body{font-family:var(--font);background:var(--bg);margin:0;padding:20px;text-transform:uppercase;color:var(--text);}
header{text-align:center;font-size:2rem;margin-bottom:5px}
#deadline-banner { background: #333; color: #fff; padding: 10px; margin: 10px 16px; border-radius: 8px; font-weight: bold; overflow: hidden; }
.tgl-aman { color: #00ff00; } .tgl-waspada { color: #ffff00; animation: blink 0.8s infinite; } .tgl-lewat { color: #ff4444; animation: pulse 1.5s infinite; } 
@keyframes blink { 0% { opacity: 1; } 50% { opacity: 0; } 100% { opacity: 1; } }
@keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.02); } 100% { transform: scale(1); } }
.menu-container {position:fixed; top:12px; right:12px; z-index:1000; display:flex; flex-direction:column; align-items:flex-end; gap:8px}
.menu-items {display:none; flex-direction:column; gap:8px; background:rgba(0,0,0,0.9); padding:12px; border-radius:12px; width: 250px;}
.menu-items.show {display:flex}
button.primary{background:var(--accent);color:#fff}
button.off{background:#999;color:#fff}
button.warning{background:#f0ad4e;color:#fff;border:1px solid #fff}
.block{margin:16px;padding:14px;background:var(--card);border-radius:14px;box-shadow:0 2px 8px rgba(0,0,0,.08);position:relative;}
.grand-total-table{width:100%;border-collapse:collapse;margin-top:10px}
.grand-total-table th, .grand-total-table td{border:1px solid var(--border);padding:8px;text-align:center;font-weight:700}
#totalMasuk { background:var(--success); color:#ffffff; }
#totalKeluar { background:var(--danger); color:#ffffff; }
.saldo-akhir { background:var(--yellow); color:#000000; }
table{width:100%;border-collapse:collapse}
th,td{border:1px solid var(--border);padding:6px;text-align:left}
th{text-align:center; background:#eee; color:#000}
input{padding:4px;border-radius:6px;border:1px solid #ccc;width:100%;box-sizing:border-box;text-transform:none;color:inherit; background:transparent;}
.admin-only-cell { display: none; text-align: center; width: 40px; }
#adminTools { display:none; flex-direction:column; gap:8px; border-top:1px solid #555; padding-top:10px; }
#checklistModal { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.9); z-index:2000; padding:20px; overflow-y:auto;}
.checklist-content { background:#fff; color:#000; padding:20px; border-radius:10px; max-width:950px; margin:0 auto; }
.status-v { background:#93c47d; } .status-x { background:#e06666; }
</style>
</head>
<body>

<div id="welcomeScreen">
    <img src="logo.png" alt="LOGO MAWAR 3" class="logo-welcome">
    <h1>SELAMAT DATANG DI WEBSITE KAS GANG MAWAR 3</h1>
    <p>Built and developed by Fajar Ilmanosa Viar Copyright ¬© 2026 Gang Mawar 3 . All Rights Reserved.</p>
    <button id="enterBtn" onclick="masukWeb()">ENTER</button>
</div>

<div class="logo-mawar-container">
    <img src="logo.png" alt="LOGO" class="logo-img">
</div>

<header>
  LAPORAN KAS GANG MAWAR 3
  <div style="margin-top:10px; text-align:center">
    <button onclick="prevMonth()">‚óÄ</button>
    <span id="periode" style="min-width:180px; display:inline-block">...</span>
    <button onclick="nextMonth()">‚ñ∂</button>
  </div>
  <div style="text-align:center; font-size:0.85rem; color:#666;" id="lastUpdate">TERAKHIR DI UPDATE PADA: -</div>
</header>

<div id="deadline-banner">
    <marquee id="deadline-text" scrollamount="5">Mengecek tanggal...</marquee>
</div>

<div class="menu-container">
    <button class="primary" onclick="toggleMenu()" style="background:#333; border:2px solid #fff;">‚ò∞ MENU</button>
    <div class="menu-items" id="menuItems">
        <button id="adminBtn" class="off">ADMIN OFF</button>
        <div id="adminTools">
            <button onclick="tambahBaris('WARGA')" style="background:#28a745; color:#fff;">üë§ TAMBAH WARGA</button>
            <button onclick="tambahBaris('LAIN')" style="background:#17a2b8; color:#fff;">üí∞ PEMASUKAN LAIN</button>
            <button id="pullBtn" class="warning">TARIK SALDO LALU</button>
        </div>
        <button onclick="openChecklist()" class="primary">CHECKLIST KAS</button>
        <button id="themeBtn" class="primary">GANTI TEMA</button>
        <button id="cetakBtn" class="primary">CETAK LAPORAN</button>
    </div>
</div>

<div class="block">
<h2>PEMASUKAN</h2>
<table>
<tr><th style="width:40px">Tgl</th><th style="width:25%">Nama</th><th style="width:40%">Keterangan</th><th style="width:15%">Masuk</th><th style="width:15%">Saldo</th><th class="admin-only-cell">Hps</th></tr>
<tbody id="tbMasuk"></tbody>
</table>
</div>

<div class="block">
<h2>PENGELUARAN</h2>
<table>
<tr><th style="width:30px">Tgl</th><th style="width:40%">Keterangan</th><th style="width:8%">Qty</th><th style="width:25%">Harga</th><th style="width:25%">Total</th><th class="admin-only-cell">Hps</th></tr>
<tbody id="tbKeluar"></tbody>
</table>
</div>

<div class="block">
<h2>GRAND TOTAL</h2>
<table class="grand-total-table">
<tr><th>TOTAL UANG MASUK</th><th>TOTAL UANG KELUAR</th><th>SALDO AKHIR</th></tr>
<tr><td id="totalMasuk">0</td><td id="totalKeluar">0</td><td id="saldoAkhir" class="saldo-akhir">0</td></tr>
</table>
</div>

<div id="checklistModal">
    <div style="text-align:center; margin-bottom:10px;">
        <button onclick="closeChecklist()" style="background:red; color:#fff;">TUTUP [X]</button>
    </div>
    <div class="checklist-content" id="checklistPrintArea">
        <h1 style="text-align:center; background:#92c694; padding:10px; margin:0;">CHECKLIST KAS GANG MAWAR 3</h1>
        <h2 id="subJudulChecklist" style="text-align:center; background:#d9ead3; padding:5px; border-bottom:2px solid #000; margin:0;">PERIODE 2026</h2>
        <table style="width:100%; border:2px solid #000; margin-top:10px;">
            <thead id="headCheck">
                <tr><th rowspan="2">No.</th><th rowspan="2">NAMA</th><th colspan="12">BULAN</th></tr>
                <tr><th>JAN</th><th>FEB</th><th>MAR</th><th>APR</th><th>MEI</th><th>JUN</th><th>JUL</th><th>AGT</th><th>SEP</th><th>OKT</th><th>NOV</th><th>DES</th></tr>
            </thead>
            <tbody id="tbChecklist" style="text-align:center; font-weight:bold;"></tbody>
        </table>
    </div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

<script>
const firebaseConfig = {
    apiKey: "AIzaSyAn5Iw4cI8bRSGuyRr3TNNVWzQA-duRHvk",
    authDomain: "kasmawar3-59c18.firebaseapp.com",
    databaseURL: "https://kasmawar3-59c18-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "kasmawar3-59c18",
    storageBucket: "kasmawar3-59c18.firebasestorage.app",
    messagingSenderId: "643313437210",
    appId: "1:643313437210:web:7377bbd6e4cd9aa33b5fa3"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

const namaBulan=['JANUARI','FEBRUARI','MARET','APRIL','MEI','JUNI','JULI','AGUSTUS','SEPTEMBER','OKTOBER','NOVEMBER','DESEMBER'];
const namaAnggotaAwal=['SISA KAS SEBELUMNYA','RIZAL','ROMI','TRI','ANIS','FAJAR DJAKA','FAJAR SHANUM','AGUS','LUKMAN','IRAWAN','RIAN','MULYADIE','HELDI','HILMAN','NANO','TEGUH'];

let bulan = new Date().getMonth(), tahun = 2026, isAdmin = false, autoSaveTimer = null;

function masukWeb() {
    let kunci = prompt("MASUKKAN BLOK RUMAH:");
    if (kunci) { document.getElementById('welcomeScreen').remove(); updateUI(); }
}

function toggleMenu() { document.getElementById('menuItems').classList.toggle('show'); }

function tambahBaris(tipe) {
    const tb = (tipe === 'KELUAR') ? document.getElementById('tbKeluar') : document.getElementById('tbMasuk');
    const tr = document.createElement('tr');
    if(tipe === 'KELUAR'){
        tr.innerHTML = `<td><input class='editable' type='date'></td><td><input class='editable'></td><td><input class='editable' value='0'></td><td><input class='editable' value='0'></td><td class='total'>0</td><td class='admin-only-cell' style='display:table-cell'><button onclick='hapusBaris(this)' style='background:red; color:white; border-radius:5px;'>X</button></td>`;
    } else {
        const n = (tipe === 'WARGA') ? 'WARGA BARU' : 'PEMASUKAN LAIN-LAIN';
        tr.innerHTML = `<td><input class='editable' type='date'></td><td><input class='editable' value='${n}'></td><td><input class='editable'></td><td><input class='editable' value='0'></td><td class='saldo'>0</td><td class='admin-only-cell' style='display:table-cell'><button onclick='hapusBaris(this)' style='background:red; color:white; border-radius:5px;'>X</button></td>`;
    }
    tb.appendChild(tr);
    recalc();
}

function hapusBaris(btn) {
    if(confirm("HAPUS BARIS INI, TUAN?")) { btn.parentElement.parentElement.remove(); recalc(); saveData(); }
}

function buildTables(){
    document.getElementById('tbMasuk').innerHTML=''; document.getElementById('tbKeluar').innerHTML='';
    namaAnggotaAwal.forEach(n => {
        const tr = document.createElement('tr');
        tr.innerHTML = `<td><input class='editable' type='date'></td><td><input class='editable' value='${n}'></td><td><input class='editable'></td><td><input class='editable' value='0'></td><td class='saldo'>0</td><td class='admin-only-cell'></td>`;
        document.getElementById('tbMasuk').appendChild(tr);
    });
}

function recalc(){
    let tM=0, tK=0, runM=0;
    document.querySelectorAll('#tbMasuk tr').forEach(tr=>{
        let u=parseInt(tr.children[3].firstChild.value.replace(/[^0-9]/g,''))||0; runM+=u; tM+=u;
        tr.children[3].firstChild.value=u.toLocaleString('id-ID');
        tr.children[4].textContent=runM.toLocaleString('id-ID');
        let k = tr.children[2].firstChild.value.toUpperCase();
        tr.querySelectorAll('input').forEach(i => i.style.backgroundColor = k.includes('LUNAS') ? 'var(--success)' : (k.includes('BELUM') ? 'var(--danger)' : 'transparent'));
    });
    document.querySelectorAll('#tbKeluar tr').forEach(tr=>{
        let q=parseInt(tr.children[2].firstChild.value.replace(/[^0-9]/g,''))||0, h=parseInt(tr.children[3].firstChild.value.replace(/[^0-9]/g,''))||0, t=q*h; tK+=t;
        tr.children[4].textContent=t.toLocaleString('id-ID');
    });
    document.getElementById('totalMasuk').textContent=tM.toLocaleString('id-ID');
    document.getElementById('totalKeluar').textContent=tK.toLocaleString('id-ID');
    document.getElementById('saldoAkhir').textContent=(tM-tK).toLocaleString('id-ID');
    document.querySelectorAll('.editable').forEach(i=>i.disabled=!isAdmin);
    document.querySelectorAll('.admin-only-cell').forEach(c=>c.style.display=isAdmin?'table-cell':'none');
}

function loadData(){
    buildTables();
    db.ref('kas_data/'+bulan+'-'+tahun).once('value', s=>{
        const d=s.val();
        if(d && d.masuk){
            document.getElementById('tbMasuk').innerHTML='';
            d.masuk.forEach(r=>{
                const tr=document.createElement('tr');
                tr.innerHTML=`<td><input class='editable' type='date' value='${r.tanggal||''}'></td><td><input class='editable' value='${r.nama||''}'></td><td><input class='editable' value='${r.ket||''}'></td><td><input class='editable' value='${r.uang||'0'}'></td><td class='saldo'>0</td><td class='admin-only-cell'><button onclick='hapusBaris(this)' style='background:red; color:white; border-radius:5px;'>X</button></td>`;
                document.getElementById('tbMasuk').appendChild(tr);
            });
        }
        recalc();
    });
}

function saveData(){
    if(!isAdmin) return;
    const m=[...document.querySelectorAll('#tbMasuk tr')].map(tr=>({tanggal:tr.children[0].firstChild.value, nama:tr.children[1].firstChild.value, ket:tr.children[2].firstChild.value, uang:tr.children[3].firstChild.value}));
    db.ref('kas_data/'+bulan+'-'+tahun).update({masuk:m, updated: new Date().toLocaleString()});
}

async function openChecklist() {
    const modal = document.getElementById('checklistModal'), tb = document.getElementById('tbChecklist');
    tb.innerHTML = '<tr><td colspan="14">Memindai Warga...</td></tr>'; modal.style.display = 'block';
    
    let listWarga = [...namaAnggotaAwal];
    for(let m=0; m<=11; m++){
        const snap = await db.ref(`kas_data/${m}-${tahun}`).once('value'), d = snap.val();
        if(d && d.masuk) d.masuk.forEach(r => { 
            if(r.nama && !listWarga.includes(r.nama) && r.nama !== 'PEMASUKAN LAIN-LAIN') listWarga.push(r.nama);
        });
    }

    tb.innerHTML = '';
    listWarga.forEach((nama, i) => {
        if(i===0) return;
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${i}</td><td style='text-align:left'>Bpk. ${nama}</td>` + Array(12).fill('<td class="status-x">X</td>').join('');
        tb.appendChild(tr);
    });
    toggleMenu();
}

document.getElementById('adminBtn').onclick = function() {
    if(!isAdmin){
        if(prompt('PASS') === 'SANUMION'){
            isAdmin=true; this.textContent='ADMIN ON'; this.className='primary';
            document.getElementById('adminTools').style.display='flex';
            autoSaveTimer=setInterval(saveData, 3000); recalc();
        }
    } else {
        isAdmin=false; this.textContent='ADMIN OFF'; this.className='off';
        document.getElementById('adminTools').style.display='none';
        clearInterval(autoSaveTimer); recalc();
    }
};

function updateDeadlineBanner() {
    const d = new Date().getDate(), b = document.getElementById('deadline-text');
    if (d <= 3) b.innerHTML = `<span class="tgl-aman">‚ö†Ô∏è REMINDER: Awal bulan nih bapak-bapak, jangan lupa bayar kas gang ‚ö†Ô∏è</span>`; 
    else if (d <= 7) b.innerHTML = `<span class="tgl-waspada">‚ö†Ô∏è PERHATIAN: Batas iuran kas ditunggu sampai tanggal 7 ‚ö†Ô∏è</span>`; 
    else b.innerHTML = `<span class="tgl-lewat">üõë Segera bayar kas bagi yang belum, hubungi bendahara üõë</span>`;
}

function updateUI(){ document.getElementById('periode').textContent=namaBulan[bulan]+' '+tahun; loadData(); }
function prevMonth(){ bulan--; if(bulan<0){bulan=11; tahun--;} updateUI(); }
function nextMonth(){ bulan++; if(bulan>11){bulan=0; tahun++;} updateUI(); }
function closeChecklist() { document.getElementById('checklistModal').style.display = 'none'; }

document.addEventListener('input', recalc);
updateDeadlineBanner();
</script>
</body>
</html>
