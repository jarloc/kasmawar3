<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=1024">
<title>LAPORAN KAS GANG MAWAR 3</title>
<style>
:root{
 --bg:#f5f5f5;--card:#ffffff;--text:#000000;--border:#cccccc;--accent:#4caf50;--danger:#d9534f;--success:#28a745;--yellow:#fff200;--font:Arial,sans-serif;
}
body{font-family:var(--font);background:var(--bg);margin:0;padding:20px;text-transform:uppercase;color:var(--text); overflow-x:hidden;}

/* --- WELCOME SCREEN STYLE --- */
#welcomeScreen {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
    background: #000; color: #fff; z-index: 9999; 
    display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center;
}
#welcomeScreen h1 { font-size: 2.2rem; margin-bottom: 10px; color: #00ffcc; text-shadow: 0 0 10px #00ffcc; }
#welcomeScreen p { font-size: 0.9rem; color: #aaa; text-transform: none; margin-bottom: 30px; }
#welcomeInput { 
    padding: 12px; width: 300px; border-radius: 8px; border: 2px solid #00ffcc; 
    background: transparent; color: #fff; text-align: center; font-size: 1.1rem; outline: none;
}
#welcomeInput::placeholder { color: rgba(255,255,255,0.5); font-style: italic; text-transform: none; }
#welcomeInput:focus { box-shadow: 0 0 15px #00ffcc; }
#enterBtn { 
    margin-top: 20px; padding: 12px 40px; background: #00ffcc; color: #000; 
    font-weight: bold; border-radius: 8px; border: none; cursor: pointer; transition: 0.3s;
}
#enterBtn:hover { background: #fff; transform: scale(1.1); }

header{text-align:center;font-size:2rem;margin-bottom:5px}
.update-info {text-align:center; font-size:0.85rem; color:#666; margin-bottom:10px; font-weight:normal; text-transform:none;}

/* STYLE UNTUK RUNNING TEXT DEADLINE */
#deadline-banner {
    background: #333; color: #fff; padding: 10px; margin: 10px 16px; 
    border-radius: 8px; font-weight: bold; overflow: hidden; white-space: nowrap;
}
#deadline-banner marquee { font-size: 1.1rem; }
.tgl-aman { color: #00ff00; } 
.tgl-waspada { color: #ffff00; animation: blink 0.8s infinite; } 
.tgl-lewat { color: #ff4444; animation: pulse 1.5s infinite; } 

@keyframes blink { 0% { opacity: 1; } 50% { opacity: 0; } 100% { opacity: 1; } }
@keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.02); } 100% { transform: scale(1); } }

.menu-container {position:fixed; top:12px; right:12px; z-index:1000; display:flex; flex-direction:column; align-items:flex-end; gap:8px}
.menu-items {display:none; flex-direction:column; gap:8px; background:rgba(0,0,0,0.9); padding:12px; border-radius:8px; box-shadow:0 4px 20px rgba(0,0,0,0.4)}
.menu-items.show {display:flex}
button{padding:10px 16px; border:0; border-radius:8px; font-weight:600; cursor:pointer; text-transform:uppercase}
button.main-menu {background:#333; color:#fff; border:2px solid #fff}
button.primary{background:var(--accent);color:#fff}
button.off{background:#999;color:#fff}
button.warning{background:#f0ad4e;color:#fff;border:1px solid #fff}

.block{margin:16px;padding:14px;background:var(--card);border-radius:14px;box-shadow:0 2px 8px rgba(0,0,0,.08);position:relative;transition:all 0.3s}
.block h2{font-size:1.3rem;margin-bottom:10px;text-align:center}

/* ANIMASI SEISMOGRAF */
.pulse-line { display:none; height:2px; width:100%; background:linear-gradient(90deg, transparent, #00ffcc, #ff00ff, transparent); position:relative; margin-bottom:15px; overflow:hidden; }
.pulse-line::after { content:""; position:absolute; left:-100%; width:100%; height:100%; background:linear-gradient(90deg, transparent, #fff, transparent); animation: pulse-move 2s infinite linear; }
@keyframes pulse-move { 0% { left: -100%; } 100% { left: 100%; } }

/* TABEL GRAND TOTAL */
.grand-total-table{width:100%;border-collapse:collapse;margin-top:10px}
.grand-total-table th, .grand-total-table td{border:1px solid var(--border);padding:8px;text-align:center;font-weight:700}
#totalMasuk { background:var(--success); color:#fff; }
#totalKeluar { background:var(--danger); color:#fff; }
.saldo-akhir { background:var(--yellow); color:#000; }

/* NOTE BOX */
.note-box {border:2px dashed var(--border); padding:20px; background:rgba(0,0,0,0.03); border-radius:12px; margin-top:20px;}
#catatanWarga { width:100%; background:transparent; border:0; color:var(--text); font-family:inherit; font-size:1.1rem; resize:none; text-transform:none; min-height:50px; overflow:hidden; line-height:1.5; white-space: pre-wrap; word-wrap: break-word; display: block; }
#catatanPrint { display: none; white-space: pre-wrap; font-size:1.1rem; line-height:1.5; text-transform:none; }

table{width:100%;border-collapse:collapse}
th,td{border:1px solid var(--border);padding:6px;text-align:left}
th{text-align:center; background:#eee; color:#000}
input{padding:4px;border-radius:6px;border:1px solid #ccc;width:100%;box-sizing:border-box;text-transform:none;font-family:inherit}
input[disabled]{background:transparent; color:var(--text); border:1px solid transparent}

/* THEME CYBERPUNK */
.theme-cyberpunk{--bg:#050505;--card:#0f0f0f;--text:#00ffcc;--border:#ff00ff;--accent:#ffff00;--yellow:#ffff00;}
.theme-cyberpunk .pulse-line { display:block; }
.theme-cyberpunk .block { border: 1px solid #00ffcc; box-shadow: 0 0 15px rgba(0,255,204,0.3); }
.theme-cyberpunk th { background:#1a1a1a; color:#ff00ff; border: 1px solid #00ffcc; }
.theme-cyberpunk td { border: 1px solid #ff00ff; }
.theme-cyberpunk tr:nth-child(odd) td { border-color: #00ffcc; }
.theme-cyberpunk tr:nth-child(even) td { border-color: #ffff00; }
.theme-cyberpunk input, .theme-cyberpunk textarea { color:#fff; text-shadow: 0 0 5px #fff; }
.theme-cyberpunk #totalMasuk { background:#00ff00; color:#000; box-shadow: 0 0 10px #00ff00; }
.theme-cyberpunk #totalKeluar { background:#ff0000; color:#fff; box-shadow: 0 0 10px #ff0000; }
.theme-cyberpunk .saldo-akhir { background:#ffff00; color:#000; box-shadow: 0 0 10px #ffff00; }

/* MODAL CHECKLIST & PENGUNJUNG */
#checklistModal, #visitorModal { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.9); z-index:2000; overflow-y:auto; padding:20px; box-sizing:border-box; }
.modal-content { background:#fff; color:#000; padding:20px; border-radius:10px; max-width:950px; margin:0 auto; }
</style>
</head>
<body style="overflow: hidden;"> <div id="welcomeScreen">
    <h1>SELAMAT DATANG DI WEBSITE KAS GANG MAWAR 3</h1>
    <p>Built and developed by Fajar Ilmanosa Viar ¬© 2026 . All Rights Reserved.</p>
    <div style="margin-top:10px">
        <input type="text" id="welcomeInput" placeholder="tulis nama anda disini">
        <br>
        <button id="enterBtn" onclick="masukWeb()">ENTER</button>
    </div>
</div>

<header>
  LAPORAN KAS GANG MAWAR 3
  <div style="margin-top:10px; text-align:center">
    <button onclick="prevMonth()">‚óÄ</button>
    <span id="periode" style="min-width:180px; display:inline-block">...</span>
    <button onclick="nextMonth()">‚ñ∂</button>
  </div>
  <div class="update-info" id="lastUpdate">TERAKHIR DI UPDATE PADA: -</div>
</header>

<div id="deadline-banner">
    <marquee id="deadline-text" scrollamount="5">Mengecek tanggal...</marquee>
</div>

<div class="menu-container">
    <button class="main-menu" onclick="toggleMenu()">‚ò∞ MENU</button>
    <div class="menu-items" id="menuItems">
        <button id="adminBtn" class="off">ADMIN OFF</button>
        <button id="pullBtn" class="warning" style="display:none">TARIK SALDO LALU</button>
        <button id="visitorBtn" class="warning" style="display:none" onclick="openVisitors()">DAFTAR PENGUNJUNG</button>
        <button onclick="openChecklist()" class="primary">CHECKLIST KAS</button>
        <button id="themeBtn" class="primary">GANTI TEMA</button>
        <button id="cetakBtn" class="primary">CETAK LAPORAN</button>
    </div>
</div>

<div class="block">
<h2>PEMASUKAN</h2>
<div class="pulse-line"></div>
<table id="tblMasukHeader">
<tr><th style="width:40px">Tgl</th><th style="width:25%">Nama</th><th style="width:60%">Keterangan</th><th style="width:15%">Masuk</th><th style="width:15%">Saldo</th></tr>
<tbody id="tbMasuk"></tbody>
</table>
</div>

<div class="block">
<h2>PENGELUARAN</h2>
<div class="pulse-line"></div>
<table>
<tr><th style="width:30px">Tgl</th><th style="width:40%">Keterangan</th><th style="width:8%">Qty</th><th style="width:25%">Harga</th><th style="width:25%">Total</th></tr>
<tbody id="tbKeluar"></tbody>
</table>
</div>

<div class="block">
<h2>GRAND TOTAL</h2>
<div class="pulse-line"></div>
<table class="grand-total-table">
<tr><th>TOTAL UANG MASUK</th><th>TOTAL UANG KELUAR</th><th>SALDO AKHIR</th></tr>
<tr><td id="totalMasuk">0</td><td id="totalKeluar">0</td><td id="saldoAkhir" class="saldo-akhir">0</td></tr>
</table>
</div>

<div class="block note-box">
  <h2 style="text-align:left; font-size:1.1rem; border-bottom:1px solid var(--border); padding-bottom:10px">üìå CATATAN PENTING</h2>
  <div class="pulse-line"></div>
  <textarea id="catatanWarga" class="editable" placeholder="Klik Admin ON untuk mengisi catatan di sini..." oninput="autoHeight(this)"></textarea>
  <div id="catatanPrint"></div>
</div>

<div id="visitorModal">
    <div style="text-align:center; margin-bottom:10px;">
        <button onclick="document.getElementById('visitorModal').style.display='none'" style="background:#d9534f; color:#fff;">TUTUP [X]</button>
    </div>
    <div class="modal-content">
        <h2 style="text-align:center">DAFTAR PENGUNJUNG SITUS</h2>
        <table style="width:100%; margin-top:10px; border:1px solid #000">
            <thead style="background:#eee">
                <tr><th>NO</th><th>NAMA PENGUNJUNG</th><th>TANGGAL</th><th>JAM</th></tr>
            </thead>
            <tbody id="tbVisitors"></tbody>
        </table>
    </div>
</div>

<div id="checklistModal">
    <div style="text-align:center; margin-bottom:10px;">
        <button onclick="closeChecklist()" style="background:#d9534f; color:#fff;">TUTUP [X]</button>
        <button onclick="cetakChecklist()" style="background:var(--accent); color:#fff; margin-left:10px;">CETAK GAMBAR</button>
    </div>
    <div class="modal-content" id="checklistPrintArea">
        <h1 style="text-align:center">CHECKLIST KAS GANG MAWAR 3</h1>
        <h2 id="subJudulChecklist" style="text-align:center">PERIODE 2026</h2>
        <table class="table-checklist" style="width:100%; border-collapse:collapse; border:2px solid #000">
            <thead style="background:#9fc5e8">
                <tr><th rowspan="2">No.</th><th rowspan="2">NAMA</th><th colspan="12" id="headerTahun">CHECKLIST KAS 2026</th></tr>
                <tr><th>JAN</th><th>FEB</th><th>MAR</th><th>APR</th><th>MEI</th><th>JUN</th><th>JUL</th><th>AGT</th><th>SEP</th><th>OKT</th><th>NOV</th><th>DES</th></tr>
            </thead>
            <tbody id="tbChecklist"></tbody>
        </table>
    </div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

<script>
const firebaseConfig = {
    apiKey: "AIzaSyAn5Iw4cI8bRSGuyRr3TNNVWzQA-duRHvk",
    authDomain: "kasmawar3-59c18.firebaseapp.com",
    databaseURL: "https://kasmawar3-59c18-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "kasmawar3-59c18",
    storageBucket: "kasmawar3-59c18.firebasestorage.app",
    messagingSenderId: "643313437210",
    appId: "1:643313437210:web:7377bbd6e4cd9aa33b5fa3",
    measurementId: "G-KY0GS26WNT"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

const skrg = new Date();
let bulan = skrg.getMonth(), tahun = skrg.getFullYear();
let isAdmin=false, autoSaveTimer=null, currentTheme='';
const namaBulan=['JANUARI','FEBRUARI','MARET','APRIL','MEI','JUNI','JULI','AGUSTUS','SEPTEMBER','OKTOBER','NOVEMBER','DESEMBER'];
const namaAnggota=['SISA KAS SEBELUMNYA','RIZAL','ROMI','TRI','ANIS','FAJAR DJAKA','FAJAR SHANUM','AGUS','LUKMAN','IRAWAN','RIAN','MULYADIE','HELDI','HILMAN','NANO','TEGUH'];

// --- FUNGSI WELCOME SCREEN & LOGGER ---
function masukWeb() {
    const nama = document.getElementById('welcomeInput').value.trim();
    if (nama === "") { alert("Mohon isi nama anda terlebih dahulu!"); return; }
    
    // Log ke Firebase
    const tgl = new Date();
    const jamStr = tgl.getHours().toString().padStart(2,'0') + ":" + tgl.getMinutes().toString().padStart(2,'0') + " WIB";
    const tglStr = tgl.getDate() + " " + namaBulan[tgl.getMonth()] + " " + tgl.getFullYear();
    
    db.ref('pengunjung_situs').push({
        nama: nama,
        tanggal: tglStr,
        jam: jamStr,
        timestamp: firebase.database.ServerValue.TIMESTAMP
    });

    // Buka Akses
    document.getElementById('welcomeScreen').style.display = 'none';
    document.body.style.overflow = 'auto';
}

// Support Enter Key
document.getElementById('welcomeInput').addEventListener("keypress", function(e) {
    if (e.key === "Enter") masukWeb();
});

function openVisitors() {
    toggleMenu();
    document.getElementById('visitorModal').style.display = 'block';
    const tb = document.getElementById('tbVisitors');
    tb.innerHTML = '<tr><td colspan="4">Loading data...</td></tr>';
    
    db.ref('pengunjung_situs').orderByChild('timestamp').limitToLast(100).once('value', s => {
        tb.innerHTML = '';
        let i = 1;
        const data = [];
        s.forEach(child => { data.unshift(child.val()); }); // Balik urutan jadi terbaru di atas
        data.forEach(v => {
            const tr = document.createElement('tr');
            tr.innerHTML = `<td style="text-align:center">${i++}</td><td>${v.nama}</td><td style="text-align:center">${v.tanggal}</td><td style="text-align:center">${v.jam}</td>`;
            tb.appendChild(tr);
        });
    });
}

// --- FUNGSI UTAMA LAINNYA ---
function autoHeight(elem) {
    elem.style.height = "1px";
    elem.style.height = (elem.scrollHeight) + "px";
}

function updateDeadlineBanner() {
    const hariIni = new Date().getDate();
    const banner = document.getElementById('deadline-text');
    if (hariIni >= 1 && hariIni <= 3) banner.innerHTML = `<span class="tgl-aman">‚ö†Ô∏è REMINDER: Batas iuran kas bulan ini adalah tanggal 7 ‚ö†Ô∏è</span>`;
    else if (hariIni >= 4 && hariIni <= 7) banner.innerHTML = `<span class="tgl-waspada">‚ö†Ô∏è PERHATIAN: Batas iuran sampai tanggal 7 ‚ö†Ô∏è</span>`;
    else banner.innerHTML = `<span class="tgl-lewat">üõë BATAS IURAN SUDAH LEWAT üõë</span>`;
}

function toggleMenu() { document.getElementById('menuItems').classList.toggle('show'); }

function buildTables(){
 document.getElementById('tbMasuk').innerHTML=''; document.getElementById('tbKeluar').innerHTML='';
 namaAnggota.forEach(n=>{
  const tr=document.createElement('tr');
  tr.innerHTML=`<td><input class='editable' type='date'></td><td><input class='editable' value='${n}'></td><td><input class='editable'></td><td><input class='editable' value='0'></td><td class='saldo'>0</td>`;
  document.getElementById('tbMasuk').appendChild(tr);
 });
 for(let i=0;i<10;i++){
  const tr=document.createElement('tr');
  tr.innerHTML=`<td><input class='editable' type='date'></td><td><input class='editable'></td><td><input class='editable' value='0'></td><td><input class='editable' value='0'></td><td class='total'>0</td>`;
  document.getElementById('tbKeluar').appendChild(tr);
 }
}

function recalc(){
 let tM=0, tK=0, runM=0;
 document.querySelectorAll('#tbMasuk tr').forEach(tr=>{
  let u=parseInt(tr.children[3].firstChild.value.replace(/[^0-9]/g,''))||0; runM+=u; tM+=u;
  tr.children[3].firstChild.value=u.toLocaleString('id-ID');
  tr.children[4].textContent=runM.toLocaleString('id-ID');
  const ketVal=tr.children[2].firstChild.value.toUpperCase();
  const inputs=tr.querySelectorAll('input');
  if(ketVal.includes('BELUM BAYAR')){ inputs.forEach(inp=>{inp.style.backgroundColor='var(--danger)'; inp.style.color='#fff';}); }
  else if(["LUNAS","SUDAH BAYAR","SISA KAS"].some(k=>ketVal.includes(k))){ inputs.forEach(inp=>{inp.style.backgroundColor='var(--success)'; inp.style.color='#fff';}); }
  else { inputs.forEach(inp=>{inp.style.backgroundColor='transparent'; inp.style.color='var(--text)';}); }
 });
 document.querySelectorAll('#tbKeluar tr').forEach(tr=>{
  let q=parseInt(tr.children[2].firstChild.value.replace(/[^0-9]/g,''))||0, h=parseInt(tr.children[3].firstChild.value.replace(/[^0-9]/g,''))||0;
  let t=q*h; tK+=t;
  tr.children[2].firstChild.value=q.toLocaleString('id-ID'); tr.children[3].firstChild.value=h.toLocaleString('id-ID'); tr.children[4].textContent=t.toLocaleString('id-ID');
 });
 document.getElementById('totalMasuk').textContent=tM.toLocaleString('id-ID');
 document.getElementById('totalKeluar').textContent=tK.toLocaleString('id-ID');
 document.getElementById('saldoAkhir').textContent=(tM-tK).toLocaleString('id-ID');
}

function loadData(){
 buildTables();
 db.ref('kas_data/'+bulan+'-'+tahun).once('value', s=>{
  const d=s.val();
  if(d){
   if(d.masuk) d.masuk.forEach((r,i)=>{ const tr=document.querySelectorAll('#tbMasuk tr')[i]; if(tr){ tr.children[0].firstChild.value=r.tanggal||''; tr.children[1].firstChild.value=r.nama||namaAnggota[i]; tr.children[2].firstChild.value=r.ket||''; tr.children[3].firstChild.value=r.uang||'0'; } });
   if(d.keluar) d.keluar.forEach((r,i)=>{ const tr=document.querySelectorAll('#tbKeluar tr')[i]; if(tr){ tr.children[0].firstChild.value=r.tanggal||''; tr.children[1].firstChild.value=r.ket||''; tr.children[2].firstChild.value=r.qty||'0'; tr.children[3].firstChild.value=r.harga||'0'; } });
   if(d.updated) document.getElementById('lastUpdate').textContent = "TERAKHIR DI UPDATE PADA: " + d.updated;
  }
  recalc(); applyAdminLock();
 });
 db.ref('kas_data/catatan_umum').once('value', snapshot => {
    const cat = snapshot.val();
    const ta = document.getElementById('catatanWarga');
    if(cat) { ta.value = cat; document.getElementById('catatanPrint').innerText = cat; setTimeout(()=>autoHeight(ta), 150); }
 });
}

function saveData(){
 if(!isAdmin) return;
 const tgl = new Date();
 const formatUpdate = tgl.getDate() + " " + namaBulan[tgl.getMonth()] + " " + tgl.getFullYear() + ", PUKUL " + tgl.getHours().toString().padStart(2,'0') + ":" + tgl.getMinutes().toString().padStart(2,'0') + " WIB";
 const m=[...document.querySelectorAll('#tbMasuk tr')].map(tr=>({tanggal:tr.children[0].firstChild.value, nama:tr.children[1].firstChild.value, ket:tr.children[2].firstChild.value, uang:tr.children[3].firstChild.value}));
 const k=[...document.querySelectorAll('#tbKeluar tr')].map(tr=>({tanggal:tr.children[0].firstChild.value, ket:tr.children[1].firstChild.value, qty:tr.children[2].firstChild.value, harga:tr.children[3].firstChild.value}));
 const cat = document.getElementById('catatanWarga').value;
 db.ref('kas_data/'+bulan+'-'+tahun).update({masuk:m, keluar:k, updated:formatUpdate});
 db.ref('kas_data/catatan_umum').set(cat);
 document.getElementById('catatanPrint').innerText = cat;
 document.getElementById('lastUpdate').textContent = "TERAKHIR DI UPDATE PADA: " + formatUpdate;
}

document.getElementById('adminBtn').onclick = function() {
 if(!isAdmin){
  let u=prompt('USER'), p=prompt('PASS');
  if(u && u.toUpperCase()==='ADMIN' && p && p.toUpperCase()==='SANUMION'){
   isAdmin=true; this.textContent='ADMIN ON'; this.className='primary';
   document.getElementById('pullBtn').style.display='block';
   document.getElementById('visitorBtn').style.display='block';
   autoSaveTimer=setInterval(saveData, 3000);
   applyAdminLock(); recalc(); alert('LOGIN BERHASIL!');
  } else { alert('USER/PASS SALAH!'); }
 } else {
  isAdmin=false; this.textContent='ADMIN OFF'; this.className='off';
  document.getElementById('pullBtn').style.display='none';
  document.getElementById('visitorBtn').style.display='none';
  clearInterval(autoSaveTimer); applyAdminLock();
 }
 toggleMenu();
};

async function openChecklist() {
    toggleMenu();
    const modal = document.getElementById('checklistModal');
    const tb = document.getElementById('tbChecklist');
    document.getElementById('headerTahun').innerText = `CHECKLIST KAS ${tahun}`;
    tb.innerHTML = '<tr><td colspan="14">Loading...</td></tr>';
    modal.style.display = 'block';
    const matrix = {};
    for (let m = 0; m <= 11; m++) {
        const snap = await db.ref(`kas_data/${m}-${tahun}`).once('value');
        const d = snap.val();
        namaAnggota.forEach((nama, idx) => {
            if (idx === 0) return;
            if (!matrix[nama]) matrix[nama] = Array(12).fill('X');
            if (d && d.masuk) {
                const row = d.masuk.find(r => r.nama === nama);
                if (row) {
                    const ket = (row.ket||'').toUpperCase();
                    if (["LUNAS","SUDAH BAYAR"].some(k=>ket.includes(k))) matrix[nama][m] = '‚úì';
                }
            }
        });
    }
    tb.innerHTML = '';
    Object.keys(matrix).forEach((nama, i) => {
        const tr = document.createElement('tr');
        let html = `<td>${i+1}</td><td style="text-align:left">${nama}</td>`;
        matrix[nama].forEach(status => {
            html += `<td style="background:${status==='‚úì'?'#93c47d':'#e06666'}">${status}</td>`;
        });
        tr.innerHTML = html; tb.appendChild(tr);
    });
}

function closeChecklist() { document.getElementById('checklistModal').style.display = 'none'; }
function applyAdminLock(){ document.querySelectorAll('.editable').forEach(i=>i.disabled=!isAdmin); }
function prevMonth(){ bulan--; if(bulan<0){bulan=11; tahun--;} updateUI(); }
function nextMonth(){ bulan++; if(bulan>11){bulan=0; tahun++;} updateUI(); }
function updateUI(){ document.getElementById('periode').textContent=namaBulan[bulan]+' '+tahun; loadData(); }

document.getElementById('themeBtn').onclick=()=>{
 const th=['theme-cyberpunk','theme-dark','theme-blue',''];
 let i=th.indexOf(currentTheme)+1; if(i>=th.length) i=0;
 if(currentTheme) document.body.classList.remove(currentTheme);
 currentTheme=th[i]; if(currentTheme) document.body.classList.add(currentTheme);
};

document.getElementById('cetakBtn').onclick=()=>{
 toggleMenu(); window.scrollTo(0,0);
 const areaAdmin = document.getElementById('catatanWarga');
 const areaPrint = document.getElementById('catatanPrint');
 areaPrint.innerText = areaAdmin.value;
 areaAdmin.style.display = 'none'; areaPrint.style.display = 'block';
 setTimeout(()=>{
  html2canvas(document.body,{scale:2}).then(c=>{
   const l=document.createElement('a'); l.download=`KAS_${namaBulan[bulan]}_${tahun}.jpg`; l.href=c.toDataURL('image/jpeg',0.9); l.click();
   areaAdmin.style.display = 'block'; areaPrint.style.display = 'none';
  });
 },500);
};

document.addEventListener('input', recalc);
updateUI();
updateDeadlineBanner();
</script>
</body>
</html>
